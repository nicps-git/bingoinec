<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔧 Debug Minhas Cartelas - Correção Urgente</title>
    <link rel="stylesheet" href="minhas-cartelas.css">
    <style>
        .debug-overlay {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            z-index: 9999;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .debug-section {
            margin: 10px 0;
            padding: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            border-left: 3px solid #00ff00;
        }
        
        .error-section {
            border-left-color: #ff0000;
        }
        
        .warning-section {
            border-left-color: #ffff00;
        }
        
        .force-grid {
            display: grid !important;
            grid-template-columns: repeat(5, 1fr) !important;
            gap: 5px !important;
            max-width: 350px !important;
            margin: 10px auto !important;
        }
        
        .force-cell {
            background: #ecf0f1 !important;
            color: #2c3e50 !important;
            text-align: center !important;
            font-size: 14px !important;
            font-weight: bold !important;
            padding: 10px 5px !important;
            border-radius: 5px !important;
            border: 1px solid #bdc3c7 !important;
            min-height: 40px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        .test-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9998;
        }
        
        .test-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .test-btn:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="debug-overlay">
        <div class="debug-section">
            <strong>🔧 DEBUG ATIVO</strong><br>
            <span id="debug-timestamp"></span>
        </div>
        <div class="debug-section" id="debug-firebase">
            <strong>🔥 Firebase:</strong> <span id="firebase-status">Verificando...</span>
        </div>
        <div class="debug-section" id="debug-login">
            <strong>👤 Login:</strong> <span id="login-status">Aguardando...</span>
        </div>
        <div class="debug-section" id="debug-cartelas">
            <strong>🎫 Cartelas:</strong> <span id="cartelas-status">Nenhuma</span>
        </div>
        <div class="debug-section" id="debug-grid">
            <strong>🎯 Grid:</strong> <span id="grid-status">Não renderizado</span>
        </div>
        <div class="debug-section" id="debug-comprador">
            <strong>📝 Comprador:</strong> <span id="comprador-status">Não definido</span>
        </div>
    </div>

    <div class="test-buttons">
        <button class="test-btn" onclick="forcarExibicaoCartela()">🔧 Forçar Grid</button>
        <button class="test-btn" onclick="mostrarDadosRaw()">📊 Dados Raw</button>
        <button class="test-btn" onclick="testarLogin()">🧪 Teste Login</button>
    </div>

    <!-- Cópia da estrutura original -->
    <div class="bandeirolas">
        <div class="bandeirola bandeirola-1"></div>
        <div class="bandeirola bandeirola-2"></div>
        <div class="bandeirola bandeirola-3"></div>
        <div class="bandeirola bandeirola-4"></div>
        <div class="bandeirola bandeirola-5"></div>
        <div class="bandeirola bandeirola-6"></div>
        <div class="bandeirola bandeirola-7"></div>
        <div class="bandeirola bandeirola-8"></div>
        <div class="bandeirola bandeirola-9"></div>
        <div class="bandeirola bandeirola-10"></div>
    </div>

    <header>
        <div class="logo-empresa">
            <img src="inec.png" alt="INEC" class="logo-inec" onerror="this.src='https://via.placeholder.com/80x80/FFD700/000000?text=INEC'">
        </div>
        
        <div class="nav-links">
            <a href="index.html" class="btn-nav">🏠 Início</a>
            <a href="cartelas.html" class="btn-nav">🎫 Comprar</a>
        </div>

        <h1>🎫 Minhas Cartelas</h1>
        <h2>🎯 Acompanhe suas cartelas no Arraiá INEC!</h2>
    </header>

    <main class="container">
        <!-- Tela de Login -->
        <section id="login-comprador" class="section-card">
            <h2>👤 Consultar Minhas Cartelas</h2>
            <p>Informe seus dados para visualizar suas cartelas:</p>
            
            <form id="form-consulta">
                <div class="form-group">
                    <label for="consulta-telefone">📱 Telefone:</label>
                    <input type="tel" id="consulta-telefone" placeholder="(11) 99999-9999" 
                           value="85977777777">
                </div>
                
                <div class="form-group">
                    <label for="consulta-email">📧 Email:</label>
                    <input type="email" id="consulta-email" placeholder="seu@email.com">
                </div>
                
                <button type="submit" class="btn btn-primary">
                    🔍 Buscar Minhas Cartelas
                </button>
            </form>

            <div id="alert-msg" class="alert" style="display: none;"></div>
        </section>

        <!-- Área das Cartelas -->
        <section id="area-cartelas" class="section-card" style="display: none;">
            <!-- Informações do Comprador -->
            <div class="comprador-info">
                <h2>👤 Suas Informações</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <strong>Nome:</strong> <span id="nome-comprador-logado">Carregando...</span>
                    </div>
                    <div class="info-item">
                        <strong>Telefone:</strong> <span id="telefone-comprador-logado">Carregando...</span>
                    </div>
                    <div class="info-item">
                        <strong>Email:</strong> <span id="email-comprador-logado">Carregando...</span>
                    </div>
                    <div class="info-item">
                        <strong>Total de Cartelas:</strong> <span id="total-cartelas-comprador">0</span>
                    </div>
                </div>
                
                <button onclick="fazerLogout()" class="btn btn-secondary">
                    🚪 Sair
                </button>
            </div>

            <!-- Status do Sorteio -->
            <div class="sorteio-info">
                <h2>🎯 Status do Sorteio</h2>
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">Último número sorteado:</span>
                        <span class="status-value" id="ultimo-numero">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Total de números sorteados:</span>
                        <span class="status-value" id="total-sorteados">0</span>
                    </div>
                </div>
                
                <div class="numeros-sorteados">
                    <h3>Números sorteados:</h3>
                    <div id="numeros-sorteados-lista">
                        <span class="sem-numeros">Nenhum número sorteado ainda</span>
                    </div>
                </div>
                
                <button onclick="atualizarSorteio()" class="btn btn-primary">
                    🔄 Atualizar
                </button>
            </div>

            <!-- Lista de Cartelas -->
            <div class="cartelas-section">
                <h2>🎫 Suas Cartelas</h2>
                <div id="lista-cartelas-comprador">
                    <!-- Cartelas serão inseridas aqui pelo JavaScript -->
                </div>
            </div>
        </section>
    </main>

    <!-- Modal de BINGO -->
    <div id="modal-bingo" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="cartela-bingo-info">
                <!-- Informações do BINGO -->
            </div>
        </div>
    </div>

    <!-- Scripts Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>
    <script src="firebase-service.js"></script>

    <script>
        // ===== DEBUG SYSTEM =====
        let debugInfo = {
            firebase: false,
            login: false,
            cartelas: [],
            comprador: null,
            grid: false
        };

        function updateDebug() {
            document.getElementById('debug-timestamp').textContent = new Date().toLocaleTimeString();
            document.getElementById('firebase-status').textContent = debugInfo.firebase ? '✅ Conectado' : '❌ Desconectado';
            document.getElementById('login-status').textContent = debugInfo.login ? '✅ Logado' : '❌ Não logado';
            document.getElementById('cartelas-status').textContent = `${debugInfo.cartelas.length} cartelas`;
            document.getElementById('grid-status').textContent = debugInfo.grid ? '✅ Renderizado' : '❌ Não renderizado';
            document.getElementById('comprador-status').textContent = debugInfo.comprador ? 
                `${debugInfo.comprador.nome} (${debugInfo.comprador.telefone})` : 'Não definido';
        }

        setInterval(updateDebug, 1000);

        // ===== FUNÇÕES DE TESTE =====
        function forcarExibicaoCartela() {
            console.log('🔧 Forçando exibição de cartela de teste...');
            
            const container = document.getElementById('lista-cartelas-comprador');
            if (!container) {
                alert('❌ Container não encontrado!');
                return;
            }
            
            // Dados de teste
            const cartelaTeste = {
                id: 'TEST123',
                numeros: [1, 16, 31, 46, 61, 2, 17, 32, 47, 62, 3, 18, 33, 48, 63, 4, 19, 34, 49, 64, 5, 20, 35, 50, 65],
                preco: 5.00,
                dataCompra: new Date()
            };
            
            const cartelaDiv = document.createElement('div');
            cartelaDiv.className = 'cartela-comprador';
            cartelaDiv.innerHTML = `
                <div class="cartela-header">
                    <h3>🎫 Cartela TESTE</h3>
                    <div class="cartela-status inicio">🎯 Teste (0/24)</div>
                </div>
                <div class="bingo-header">
                    <div class="bingo-letter">B</div>
                    <div class="bingo-letter">I</div>
                    <div class="bingo-letter">N</div>
                    <div class="bingo-letter">G</div>
                    <div class="bingo-letter">O</div>
                </div>
                <div class="force-grid">
                    ${cartelaTeste.numeros.slice(0, 12).map(n => `<div class="force-cell">${n}</div>`).join('')}
                    <div class="force-cell" style="background: #f39c12 !important; color: white !important;">⭐</div>
                    ${cartelaTeste.numeros.slice(12).map(n => `<div class="force-cell">${n}</div>`).join('')}
                </div>
                <div class="cartela-info">
                    <p><strong>ID:</strong> ${cartelaTeste.id}</p>
                    <p><strong>Preço:</strong> R$ ${cartelaTeste.preco.toFixed(2)}</p>
                    <p><strong>Status:</strong> TESTE FORÇADO</p>
                </div>
            `;
            
            container.innerHTML = '';
            container.appendChild(cartelaDiv);
            
            debugInfo.grid = true;
            alert('✅ Cartela de teste forçada!');
        }

        function mostrarDadosRaw() {
            const dados = {
                debugInfo: debugInfo,
                localStorage: {
                    keys: Object.keys(localStorage),
                    values: Object.keys(localStorage).reduce((acc, key) => {
                        acc[key] = localStorage.getItem(key);
                        return acc;
                    }, {})
                },
                elementos: {
                    loginComprador: !!document.getElementById('login-comprador'),
                    areaCartelas: !!document.getElementById('area-cartelas'),
                    listaCartelas: !!document.getElementById('lista-cartelas-comprador')
                }
            };
            
            console.log('📊 DADOS RAW COMPLETOS:', dados);
            alert('📊 Dados enviados para o console. Abra o DevTools (F12).');
        }

        function testarLogin() {
            console.log('🧪 Iniciando teste de login...');
            
            // Simular dados
            debugInfo.comprador = {
                nome: 'TESTE DEBUG',
                telefone: '85977777777',
                email: 'teste@debug.com'
            };
            
            debugInfo.cartelas = [{
                id: 'DEBUG001',
                numeros: [1, 16, 31, 46, 61, 2, 17, 32, 47, 62, 3, 18, 33, 48, 63, 4, 19, 34, 49, 64, 5, 20, 35, 50, 65],
                preco: 5.00,
                nome: 'TESTE DEBUG',
                telefone: '85977777777'
            }];
            
            debugInfo.login = true;
            
            // Forçar transição
            const login = document.getElementById('login-comprador');
            const area = document.getElementById('area-cartelas');
            
            if (login) login.style.display = 'none';
            if (area) area.style.display = 'block';
            
            // Preencher dados
            const nomeEl = document.getElementById('nome-comprador-logado');
            const telEl = document.getElementById('telefone-comprador-logado');
            const emailEl = document.getElementById('email-comprador-logado');
            const totalEl = document.getElementById('total-cartelas-comprador');
            
            if (nomeEl) nomeEl.textContent = debugInfo.comprador.nome;
            if (telEl) telEl.textContent = debugInfo.comprador.telefone;
            if (emailEl) emailEl.textContent = debugInfo.comprador.email;
            if (totalEl) totalEl.textContent = debugInfo.cartelas.length;
            
            // Forçar cartela
            setTimeout(() => {
                forcarExibicaoCartela();
            }, 1000);
            
            alert('🧪 Teste de login executado!');
        }

        // ===== INICIALIZAÇÃO =====
        console.log('🔧 Debug system loaded');
        updateDebug();
        
        // Verificar Firebase
        setTimeout(() => {
            debugInfo.firebase = typeof firebase !== 'undefined';
            updateDebug();
        }, 1000);
    </script>
    
    <!-- Script principal (carregado por último) -->
    <script src="minhas-cartelas.js"></script>
</body>
</html>
