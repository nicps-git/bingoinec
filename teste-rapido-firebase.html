<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Rápido Firebase</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>🔥 Teste Rápido Firebase</h1>
    
    <div id="status"></div>
    
    <button onclick="testarConexao()">🧪 Testar Conexão</button>
    <button onclick="testarEscrita()">💾 Testar Escrita</button>
    <button onclick="listarDados()">📋 Listar Dados</button>
    <button onclick="limparTeste()">🗑️ Limpar Teste</button>
    
    <div id="resultado"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <script>
        // Configuração Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCWcZMF4Yty2aX7vAHUs_LI5R6N0S8NRy4",
            authDomain: "bingoinec.firebaseapp.com",
            projectId: "bingoinec",
            storageBucket: "bingoinec.firebasestorage.app",
            messagingSenderId: "483007152008",
            appId: "1:483007152008:web:6347c02216e162c0a3c43d"
        };

        let db;
        let testId = 'teste_' + Date.now();

        function log(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            const classes = {
                'success': 'status success',
                'error': 'status error',
                'info': 'status info'
            };
            statusDiv.className = classes[type];
            statusDiv.textContent = message;
            console.log(message);
        }

        function showResult(data) {
            const resultDiv = document.getElementById('resultado');
            resultDiv.innerHTML = '<h3>Resultado:</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';
        }

        async function inicializarFirebase() {
            try {
                // Inicializar Firebase
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                
                log('✅ Firebase inicializado com sucesso', 'success');
                return true;
            } catch (error) {
                log('❌ Erro ao inicializar Firebase: ' + error.message, 'error');
                return false;
            }
        }

        async function testarConexao() {
            log('🔄 Testando conexão...', 'info');
            
            if (!db) {
                const initialized = await inicializarFirebase();
                if (!initialized) return;
            }

            try {
                // Teste de ping simples
                const testRef = db.collection('_teste').doc('ping');
                await testRef.set({
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    teste: 'ping'
                });

                const doc = await testRef.get();
                if (doc.exists) {
                    log('✅ Conexão com Firebase funcionando!', 'success');
                    showResult(doc.data());
                    
                    // Limpar teste
                    await testRef.delete();
                } else {
                    log('⚠️ Documento não encontrado após escrita', 'error');
                }
            } catch (error) {
                log('❌ Erro de conexão: ' + error.message, 'error');
                console.error(error);
            }
        }

        async function testarEscrita() {
            log('🔄 Testando escrita de cartela...', 'info');
            
            if (!db) {
                const initialized = await inicializarFirebase();
                if (!initialized) return;
            }

            try {
                const cartela = {
                    id: testId,
                    numeros: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24],
                    preco: 5.00,
                    vendida: true,
                    comprador: 'Teste Sistema',
                    telefone: '(11) 99999-9999',
                    dataVenda: new Date().toISOString(),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };

                await db.collection('cartelas').doc(testId).set(cartela);
                
                log('✅ Cartela salva com sucesso: ' + testId, 'success');
                showResult(cartela);
            } catch (error) {
                log('❌ Erro ao salvar cartela: ' + error.message, 'error');
                console.error(error);
            }
        }

        async function listarDados() {
            log('🔄 Listando cartelas...', 'info');
            
            if (!db) {
                const initialized = await inicializarFirebase();
                if (!initialized) return;
            }

            try {
                const snapshot = await db.collection('cartelas').limit(5).get();
                
                const cartelas = [];
                snapshot.forEach((doc) => {
                    cartelas.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                log(`✅ Encontradas ${cartelas.length} cartelas`, 'success');
                showResult(cartelas);
            } catch (error) {
                log('❌ Erro ao listar cartelas: ' + error.message, 'error');
                console.error(error);
            }
        }

        async function limparTeste() {
            log('🔄 Limpando dados de teste...', 'info');
            
            if (!db) {
                const initialized = await inicializarFirebase();
                if (!initialized) return;
            }

            try {
                // Remover cartela de teste
                await db.collection('cartelas').doc(testId).delete();
                
                // Limpar documentos de teste
                const testeDocs = await db.collection('_teste').get();
                const batch = db.batch();
                testeDocs.forEach((doc) => {
                    batch.delete(doc.ref);
                });
                await batch.commit();

                log('✅ Dados de teste limpos', 'success');
                document.getElementById('resultado').innerHTML = '';
            } catch (error) {
                log('❌ Erro ao limpar: ' + error.message, 'error');
                console.error(error);
            }
        }

        // Auto-inicializar
        window.addEventListener('load', () => {
            log('🚀 Sistema carregado - clique em "Testar Conexão"', 'info');
        });
    </script>
</body>
</html>
