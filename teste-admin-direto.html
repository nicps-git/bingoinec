<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Admin Direto</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        input { padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 3px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste Admin Direto</h1>
        <div id="status-container"></div>
        
        <hr>
        
        <h3>Configura√ß√µes</h3>
        <div>
            <label>N√∫mero Inicial:</label>
            <input type="number" id="numero-inicial" value="1">
        </div>
        <div>
            <label>N√∫mero Final:</label>
            <input type="number" id="numero-final" value="75">
        </div>
        <div>
            <label>Pre√ßo Cartela:</label>
            <input type="number" id="preco-cartela" value="5.00" step="0.01">
        </div>
        
        <div>
            <strong>Total: <span id="total-numeros">75</span> n√∫meros</strong>
        </div>
        
        <hr>
        
        <h3>Controles</h3>
        <button id="salvar-config" class="btn-primary">üíæ Salvar Configura√ß√µes</button>
        <button id="resetar-jogo" class="btn-danger">üîÑ Resetar Jogo</button>
        <button id="ir-para-bingo" class="btn-success">üé™ Ir para Bingo</button>
        
        <hr>
        
        <h3>Status</h3>
        <div>
            <strong>Range Atual:</strong> <span id="range-atual">1 - 75</span><br>
            <strong>N√∫meros Sorteados:</strong> <span id="numeros-sorteados-count">0</span><br>
            <strong>N√∫meros Restantes:</strong> <span id="numeros-restantes">75</span>
        </div>
    </div>

    <!-- Scripts na mesma ordem do admin.html -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="firebase-config.js"></script>
    
    <script>
        function addStatus(message, type = 'info') {
            const container = document.getElementById('status-container');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            container.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        addStatus('üîÑ Iniciando teste...', 'info');
        
        // Testar carregamento step by step
        window.addEventListener('load', async () => {
            addStatus('üìÑ P√°gina carregada', 'success');
            
            try {
                // Teste 1: Firebase SDK
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebase SDK n√£o carregado');
                }
                addStatus('‚úÖ Firebase SDK dispon√≠vel', 'success');
                
                // Teste 2: Firebase Config
                if (typeof firebaseConfig === 'undefined') {
                    throw new Error('firebaseConfig n√£o encontrado');
                }
                addStatus('‚úÖ Firebase Config dispon√≠vel', 'success');
                
                // Teste 3: Inicializar Firebase
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                    addStatus('‚úÖ Firebase inicializado', 'success');
                }
                
                // Teste 4: Criar inst√¢ncias
                const db = firebase.firestore();
                const auth = firebase.auth();
                addStatus('‚úÖ Firestore e Auth criados', 'success');
                
                // Teste 5: Configurar bot√µes
                const btnSalvar = document.getElementById('salvar-config');
                const btnResetar = document.getElementById('resetar-jogo');
                const btnBingo = document.getElementById('ir-para-bingo');
                
                if (btnSalvar) {
                    btnSalvar.onclick = async () => {
                        addStatus('üíæ Salvando configura√ß√µes...', 'info');
                        
                        try {
                            const config = {
                                numeroInicial: parseInt(document.getElementById('numero-inicial').value),
                                numeroFinal: parseInt(document.getElementById('numero-final').value),
                                precoCartela: parseFloat(document.getElementById('preco-cartela').value),
                                jogoAtivo: true,
                                timestamp: firebase.firestore.FieldValue.serverTimestamp()
                            };
                            
                            await db.collection('configuracoes').doc('bingo').set(config);
                            addStatus('‚úÖ Configura√ß√µes salvas no Firebase!', 'success');
                            
                        } catch (error) {
                            addStatus(`‚ùå Erro ao salvar: ${error.message}`, 'error');
                        }
                    };
                    addStatus('‚úÖ Bot√£o salvar configurado', 'success');
                }
                
                if (btnResetar) {
                    btnResetar.onclick = async () => {
                        if (!confirm('Resetar jogo?')) return;
                        
                        addStatus('üîÑ Resetando jogo...', 'info');
                        
                        try {
                            const snapshot = await db.collection('numeros-sorteados').get();
                            const batch = db.batch();
                            
                            snapshot.forEach(doc => {
                                batch.delete(doc.ref);
                            });
                            
                            await batch.commit();
                            addStatus('‚úÖ Jogo resetado!', 'success');
                            
                        } catch (error) {
                            addStatus(`‚ùå Erro ao resetar: ${error.message}`, 'error');
                        }
                    };
                    addStatus('‚úÖ Bot√£o resetar configurado', 'success');
                }
                
                if (btnBingo) {
                    btnBingo.onclick = () => {
                        window.location.href = 'index.html';
                    };
                    addStatus('‚úÖ Bot√£o bingo configurado', 'success');
                }
                
                // Teste 6: Carregar dados
                try {
                    const configDoc = await db.collection('configuracoes').doc('bingo').get();
                    if (configDoc.exists) {
                        const config = configDoc.data();
                        addStatus(`‚úÖ Configura√ß√µes carregadas: ${JSON.stringify(config)}`, 'success');
                        
                        // Atualizar campos
                        document.getElementById('numero-inicial').value = config.numeroInicial || 1;
                        document.getElementById('numero-final').value = config.numeroFinal || 75;
                        document.getElementById('preco-cartela').value = (config.precoCartela || 5.00).toFixed(2);
                    } else {
                        addStatus('‚ÑπÔ∏è Nenhuma configura√ß√£o salva ainda', 'info');
                    }
                } catch (error) {
                    addStatus(`‚ö†Ô∏è Erro ao carregar configura√ß√µes: ${error.message}`, 'info');
                }
                
                // Teste 7: Atualizar contadores
                function atualizarContadores() {
                    const inicial = parseInt(document.getElementById('numero-inicial').value) || 1;
                    const final = parseInt(document.getElementById('numero-final').value) || 75;
                    const total = final - inicial + 1;
                    
                    document.getElementById('total-numeros').textContent = total;
                    document.getElementById('range-atual').textContent = `${inicial} - ${final}`;
                }
                
                document.getElementById('numero-inicial').addEventListener('input', atualizarContadores);
                document.getElementById('numero-final').addEventListener('input', atualizarContadores);
                
                atualizarContadores();
                addStatus('‚úÖ Contadores configurados', 'success');
                
                addStatus('üéâ TESTE COMPLETO - Tudo funcionando!', 'success');
                
            } catch (error) {
                addStatus(`‚ùå ERRO NO TESTE: ${error.message}`, 'error');
                console.error('Erro detalhado:', error);
            }
        });
    </script>
</body>
</html>
