<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔍 Teste Conflito de Scripts</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 50px auto; 
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px 10px 0;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin: 15px 0;
            padding: 10px;
            border-left: 4px solid #007bff;
            background: #e7f3ff;
        }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .success { border-left-color: #28a745; background: #d4edda; }
        .warning { border-left-color: #ffc107; background: #fff3cd; }
        .debug {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>🔍 Teste de Conflito de Scripts</h1>
    <p>Este teste carrega os mesmos scripts da página real para identificar conflitos.</p>

    <div class="test-section">
        <h2>📋 Scripts Carregados</h2>
        <div id="scripts-status" class="debug">Verificando scripts...</div>
    </div>

    <div class="test-section">
        <h2>🔍 Formulário de Teste</h2>
        <form id="form-consulta">
            <div class="form-group">
                <label for="consulta-telefone">📱 Telefone:</label>
                <input type="tel" id="consulta-telefone" name="telefone" placeholder="(11) 99999-9999">
            </div>

            <div class="form-group">
                <label for="consulta-email">📧 E-mail:</label>
                <input type="email" id="consulta-email" name="email" placeholder="seu@email.com">
            </div>

            <div class="form-group">
                <button type="submit">🔍 Testar Login</button>
                <button type="button" onclick="verificarEventListeners()">🔍 Verificar Listeners</button>
                <button type="button" onclick="limparResultados()">🗑️ Limpar</button>
            </div>
        </form>
    </div>

    <div class="test-section">
        <h2>📊 Resultados dos Testes</h2>
        <div id="resultados" class="result">
            Aguardando teste...
        </div>
    </div>

    <div class="test-section">
        <h2>🐛 Debug Console</h2>
        <div id="debug-console" class="debug">
            Console de debug...
        </div>
    </div>

    <!-- Exatamente os mesmos scripts da página real -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
    <script src="firebase-config.js"></script>
    <script src="firebase-service.js"></script>
    <script src="patch-busca-robusta.js"></script>
    <script src="login.js"></script>
    <script src="minhas-cartelas.js"></script>

    <script>
        // Capturar todos os logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        let debugLogs = [];
        
        function adicionarLog(tipo, ...args) {
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            debugLogs.push(`[${timestamp}] ${tipo.toUpperCase()}: ${message}`);
            atualizarDebugConsole();
            
            // Chamar função original
            if (tipo === 'log') originalLog(...args);
            else if (tipo === 'error') originalError(...args);
            else if (tipo === 'warn') originalWarn(...args);
        }
        
        console.log = (...args) => adicionarLog('log', ...args);
        console.error = (...args) => adicionarLog('error', ...args);
        console.warn = (...args) => adicionarLog('warn', ...args);
        
        function atualizarDebugConsole() {
            const debugConsole = document.getElementById('debug-console');
            if (debugConsole) {
                debugConsole.textContent = debugLogs.slice(-20).join('\n'); // Últimas 20 linhas
                debugConsole.scrollTop = debugConsole.scrollHeight;
            }
        }
        
        function mostrarResultado(message, tipo = 'info') {
            const resultados = document.getElementById('resultados');
            if (resultados) {
                resultados.className = `result ${tipo}`;
                resultados.innerHTML = `
                    <strong>${new Date().toLocaleTimeString()}</strong><br>
                    ${message}
                `;
            }
        }
        
        function verificarScripts() {
            const scriptsStatus = document.getElementById('scripts-status');
            
            const checks = {
                'Firebase': typeof firebase !== 'undefined',
                'FirebaseService': typeof FirebaseService !== 'undefined',
                'login.js funções': typeof handleLogin !== 'undefined',
                'minhas-cartelas.js funções': typeof mostrarAlerta !== 'undefined'
            };
            
            let status = 'Status dos Scripts:\n';
            for (const [nome, carregado] of Object.entries(checks)) {
                status += `${carregado ? '✅' : '❌'} ${nome}: ${carregado ? 'Carregado' : 'Não carregado'}\n`;
            }
            
            scriptsStatus.textContent = status;
            
            return checks;
        }
        
        function verificarEventListeners() {
            const form = document.getElementById('form-consulta');
            
            if (!form) {
                mostrarResultado('❌ Formulário não encontrado!', 'error');
                return;
            }
            
            // Método para verificar listeners (limitado no navegador)
            let listenersInfo = 'Informações do Formulário:\n';
            listenersInfo += `- ID: ${form.id}\n`;
            listenersInfo += `- Tag: ${form.tagName}\n`;
            listenersInfo += `- Eventos anexados: Não é possível listar diretamente\n`;
            
            // Verificar se há funções globais relevantes
            const funcoes = [
                'fazerLogin',
                'handleLogin', 
                'mostrarAlerta',
                'FirebaseService'
            ];
            
            listenersInfo += '\nFunções globais disponíveis:\n';
            funcoes.forEach(func => {
                listenersInfo += `- ${func}: ${typeof window[func] !== 'undefined' ? '✅ Disponível' : '❌ Não encontrada'}\n`;
            });
            
            mostrarResultado(listenersInfo, 'info');
        }
        
        function limparResultados() {
            debugLogs = [];
            atualizarDebugConsole();
            mostrarResultado('Resultados limpos.', 'info');
        }
        
        // Interceptar submit do formulário para teste
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 Teste de conflito inicializado');
            
            // Verificar scripts após um pequeno delay
            setTimeout(() => {
                verificarScripts();
            }, 1000);
            
            const form = document.getElementById('form-consulta');
            if (form) {
                console.log('📝 Formulário encontrado, adicionando listener de teste...');
                
                form.addEventListener('submit', (e) => {
                    console.log('🎯 SUBMIT INTERCEPTADO PELO TESTE!');
                    e.preventDefault();
                    
                    const telefone = document.getElementById('consulta-telefone').value;
                    const email = document.getElementById('consulta-email').value;
                    
                    mostrarResultado(`
                        ✅ Submit capturado com sucesso!<br>
                        📱 Telefone: "${telefone}"<br>
                        📧 Email: "${email}"<br>
                        <br>
                        ⚠️ Este é o listener de TESTE. Se você vir esta mensagem,<br>
                        significa que o formulário está funcionando corretamente.
                    `, 'success');
                    
                    console.log('📊 Dados do formulário:', { telefone, email });
                });
                
                console.log('✅ Listener de teste adicionado com sucesso');
            } else {
                console.error('❌ Formulário não encontrado para adicionar listener');
            }
        });
        
        // Verificar se há conflitos após 3 segundos
        setTimeout(() => {
            console.log('🔍 Verificação final de conflitos...');
            
            const form = document.getElementById('form-consulta');
            if (form) {
                // Tentar detectar quantos listeners há (método limitado)
                console.log('📋 Propriedades do formulário:', Object.getOwnPropertyNames(form));
                
                // Verificar se há propriedades relacionadas a eventos
                const eventProps = Object.getOwnPropertyNames(form).filter(prop => 
                    prop.startsWith('on') || prop.includes('event') || prop.includes('listener')
                );
                
                console.log('🎯 Propriedades de evento encontradas:', eventProps);
            }
            
            verificarScripts();
        }, 3000);
    </script>
</body>
</html>
