<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ« Minhas Cartelas - CORRIGIDO</title>
    <link rel="stylesheet" href="minhas-cartelas.css">
    <style>
        /* Estilos de emergÃªncia para garantir funcionamento */
        .debug-force {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(255,0,0,0.9);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 9999;
            font-weight: bold;
        }
        
        /* ForÃ§a o grid a funcionar independente do CSS principal */
        .cartela-emergencia .grid-emergencia {
            display: grid !important;
            grid-template-columns: repeat(5, 1fr) !important;
            gap: 2px !important;
            width: 100% !important;
            max-width: 300px !important;
            margin: 10px auto !important;
            border: 2px solid #007bff !important;
            padding: 5px !important;
            border-radius: 8px !important;
            background: #f8f9fa !important;
        }
        
        .cartela-emergencia .celula-emergencia {
            background: #ecf0f1 !important;
            color: #2c3e50 !important;
            text-align: center !important;
            font-size: 14px !important;
            font-weight: bold !important;
            padding: 8px 4px !important;
            border: 1px solid #bdc3c7 !important;
            border-radius: 4px !important;
            min-height: 30px !important;
            max-height: 40px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            cursor: pointer !important;
        }
        
        .cartela-emergencia .celula-livre {
            background: #f39c12 !important;
            color: white !important;
            font-size: 16px !important;
        }
        
        .cartela-emergencia .celula-sorteada {
            background: #27ae60 !important;
            color: white !important;
        }
        
        .cartela-emergencia .celula-marcada {
            background: #3498db !important;
            color: white !important;
        }
        
        .header-emergencia {
            display: grid !important;
            grid-template-columns: repeat(5, 1fr) !important;
            gap: 2px !important;
            width: 100% !important;
            max-width: 300px !important;
            margin: 5px auto !important;
        }
        
        .letra-emergencia {
            background: #e74c3c !important;
            color: white !important;
            text-align: center !important;
            font-size: 16px !important;
            font-weight: bold !important;
            padding: 8px !important;
            border-radius: 4px !important;
        }
    </style>
</head>
<body>
    <div class="debug-force">
        ğŸ”§ MODO CORREÃ‡ÃƒO ATIVO
    </div>

    <!-- Bandeirolas decorativas -->
    <div class="bandeirolas">
        <div class="bandeirola bandeirola-1"></div>
        <div class="bandeirola bandeirola-2"></div>
        <div class="bandeirola bandeirola-3"></div>
        <div class="bandeirola bandeirola-4"></div>
        <div class="bandeirola bandeirola-5"></div>
        <div class="bandeirola bandeirola-6"></div>
        <div class="bandeirola bandeirola-7"></div>
        <div class="bandeirola bandeirola-8"></div>
        <div class="bandeirola bandeirola-9"></div>
        <div class="bandeirola bandeirola-10"></div>
    </div>

    <header>
        <div class="logo-empresa">
            <img src="inec.png" alt="INEC" class="logo-inec" onerror="this.src='https://via.placeholder.com/80x80/FFD700/000000?text=INEC'">
        </div>
        
        <div class="nav-links">
            <a href="index.html" class="btn-nav">ğŸ  InÃ­cio</a>
            <a href="cartelas.html" class="btn-nav">ğŸ« Comprar</a>
            <button onclick="verificarSistema()" class="btn-nav" style="background: #dc3545;">ğŸ”§ Debug</button>
        </div>

        <h1>ğŸ« Minhas Cartelas</h1>
        <h2>ğŸ¯ Acompanhe suas cartelas no ArraiÃ¡ INEC!</h2>
    </header>

    <main class="container">
        <!-- Tela de Login -->
        <section id="login-comprador" class="section-card">
            <h2>ğŸ‘¤ Consultar Minhas Cartelas</h2>
            <p>Informe seus dados para visualizar suas cartelas:</p>
            
            <form id="form-consulta">
                <div class="form-group">
                    <label for="consulta-telefone">ğŸ“± Telefone:</label>
                    <input type="tel" id="consulta-telefone" placeholder="(11) 99999-9999" 
                           value="85977777777">
                </div>
                
                <div class="form-group">
                    <label for="consulta-email">ğŸ“§ Email:</label>
                    <input type="email" id="consulta-email" placeholder="seu@email.com">
                </div>
                
                <button type="submit" class="btn btn-primary">
                    ğŸ” Buscar Minhas Cartelas
                </button>
                
                <button type="button" onclick="testeRapido()" class="btn btn-secondary">
                    ğŸ§ª Teste RÃ¡pido
                </button>
            </form>

            <div id="alert-msg" class="alert" style="display: none;"></div>
        </section>

        <!-- Ãrea das Cartelas -->
        <section id="area-cartelas" class="section-card" style="display: none;">
            <!-- InformaÃ§Ãµes do Comprador -->
            <div class="comprador-info">
                <h2>ğŸ‘¤ Suas InformaÃ§Ãµes</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <strong>Nome:</strong> <span id="nome-comprador-logado">Carregando...</span>
                    </div>
                    <div class="info-item">
                        <strong>Telefone:</strong> <span id="telefone-comprador-logado">Carregando...</span>
                    </div>
                    <div class="info-item">
                        <strong>Email:</strong> <span id="email-comprador-logado">Carregando...</span>
                    </div>
                    <div class="info-item">
                        <strong>Total de Cartelas:</strong> <span id="total-cartelas-comprador">0</span>
                    </div>
                </div>
                
                <button onclick="fazerLogout()" class="btn btn-secondary">
                    ğŸšª Sair
                </button>
            </div>

            <!-- Status do Sorteio -->
            <div class="sorteio-info">
                <h2>ğŸ¯ Status do Sorteio</h2>
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">Ãšltimo nÃºmero sorteado:</span>
                        <span class="status-value" id="ultimo-numero">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Total de nÃºmeros sorteados:</span>
                        <span class="status-value" id="total-sorteados">0</span>
                    </div>
                </div>
                
                <div class="numeros-sorteados">
                    <h3>NÃºmeros sorteados:</h3>
                    <div id="numeros-sorteados-lista">
                        <span class="sem-numeros">Nenhum nÃºmero sorteado ainda</span>
                    </div>
                </div>
                
                <button onclick="atualizarSorteio()" class="btn btn-primary">
                    ğŸ”„ Atualizar
                </button>
            </div>

            <!-- Lista de Cartelas -->
            <div class="cartelas-section">
                <h2>ğŸ« Suas Cartelas</h2>
                <div id="lista-cartelas-comprador">
                    <!-- Cartelas serÃ£o inseridas aqui -->
                </div>
                
                <!-- Ãrea de teste de emergÃªncia -->
                <div id="area-teste-emergencia" style="display: none;">
                    <h3>ğŸ§ª Teste de Cartela (Modo EmergÃªncia)</h3>
                    <div class="cartela-emergencia">
                        <div class="header-emergencia">
                            <div class="letra-emergencia">B</div>
                            <div class="letra-emergencia">I</div>
                            <div class="letra-emergencia">N</div>
                            <div class="letra-emergencia">G</div>
                            <div class="letra-emergencia">O</div>
                        </div>
                        <div class="grid-emergencia" id="grid-teste">
                            <!-- SerÃ¡ preenchido pelo JS -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Scripts Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>
    <script src="firebase-service.js"></script>

    <script>
        console.log('ğŸ« Minhas Cartelas - VersÃ£o Corrigida Carregada');
        
        // ===== FUNÃ‡Ã•ES DE EMERGÃŠNCIA =====
        function verificarSistema() {
            console.log('ğŸ”§ VerificaÃ§Ã£o do sistema iniciada...');
            
            const checks = {
                firebase: typeof firebase !== 'undefined',
                firebaseService: typeof FirebaseService !== 'undefined',
                loginElement: !!document.getElementById('login-comprador'),
                cartelasElement: !!document.getElementById('area-cartelas'),
                listaElement: !!document.getElementById('lista-cartelas-comprador')
            };
            
            console.log('ğŸ“Š Status do sistema:', checks);
            
            const problemas = Object.entries(checks)
                .filter(([key, value]) => !value)
                .map(([key]) => key);
            
            if (problemas.length > 0) {
                alert(`âŒ Problemas encontrados: ${problemas.join(', ')}`);
            } else {
                alert('âœ… Sistema OK! Todos os componentes carregados.');
            }
        }
        
        function testeRapido() {
            console.log('ğŸ§ª Executando teste rÃ¡pido...');
            
            // Simular login com dados de teste
            const nomeEl = document.getElementById('nome-comprador-logado');
            const telEl = document.getElementById('telefone-comprador-logado');
            const emailEl = document.getElementById('email-comprador-logado');
            const totalEl = document.getElementById('total-cartelas-comprador');
            
            if (nomeEl) nomeEl.textContent = 'TESTE SISTEMA';
            if (telEl) telEl.textContent = '(85) 97777-7777';
            if (emailEl) emailEl.textContent = 'teste@sistema.com';
            if (totalEl) totalEl.textContent = '1';
            
            // Ocultar login e mostrar Ã¡rea de cartelas
            const login = document.getElementById('login-comprador');
            const area = document.getElementById('area-cartelas');
            
            if (login) login.style.display = 'none';
            if (area) area.style.display = 'block';
            
            // Criar cartela de teste
            criarCartelaTeste();
            
            alert('ğŸ§ª Teste rÃ¡pido executado! Cartela de teste criada.');
        }
        
        function criarCartelaTeste() {
            console.log('ğŸ« Criando cartela de teste...');
            
            const container = document.getElementById('lista-cartelas-comprador');
            if (!container) {
                console.error('âŒ Container nÃ£o encontrado!');
                return;
            }
            
            // NÃºmeros de teste para a cartela
            const numerosTeste = [1, 16, 31, 46, 61, 2, 17, 32, 47, 62, 3, 18, 33, 48, 63, 4, 19, 34, 49, 64, 5, 20, 35, 50, 65];
            
            const cartelaDiv = document.createElement('div');
            cartelaDiv.className = 'cartela-comprador cartela-emergencia';
            cartelaDiv.innerHTML = `
                <div class="cartela-header">
                    <h3>ğŸ« Cartela de Teste #1</h3>
                    <div class="cartela-status inicio">ğŸ¯ Teste (0/24)</div>
                </div>
                <div class="header-emergencia">
                    <div class="letra-emergencia">B</div>
                    <div class="letra-emergencia">I</div>
                    <div class="letra-emergencia">N</div>
                    <div class="letra-emergencia">G</div>
                    <div class="letra-emergencia">O</div>
                </div>
                <div class="grid-emergencia">
                    ${numerosTeste.slice(0, 12).map(n => `<div class="celula-emergencia" onclick="marcarCelula(this, ${n})">${n}</div>`).join('')}
                    <div class="celula-emergencia celula-livre">â­</div>
                    ${numerosTeste.slice(12).map(n => `<div class="celula-emergencia" onclick="marcarCelula(this, ${n})">${n}</div>`).join('')}
                </div>
                <div class="cartela-info">
                    <p><strong>ID:</strong> TESTE001</p>
                    <p><strong>PreÃ§o:</strong> R$ 5,00</p>
                    <p><strong>Status:</strong> CARTELA DE TESTE</p>
                    <p><strong>Clique nos nÃºmeros para marcar/desmarcar</strong></p>
                </div>
            `;
            
            container.innerHTML = '';
            container.appendChild(cartelaDiv);
            
            console.log('âœ… Cartela de teste criada com sucesso!');
        }
        
        function marcarCelula(elemento, numero) {
            console.log(`ğŸ¯ Marcando nÃºmero: ${numero}`);
            
            if (elemento.classList.contains('celula-livre')) {
                return; // NÃ£o marcar espaÃ§o livre
            }
            
            if (elemento.classList.contains('celula-marcada')) {
                elemento.classList.remove('celula-marcada');
                console.log(`âŒ Desmarcado: ${numero}`);
            } else {
                elemento.classList.add('celula-marcada');
                console.log(`âœ… Marcado: ${numero}`);
            }
            
            // Contar nÃºmeros marcados
            const marcados = document.querySelectorAll('.celula-marcada').length;
            const statusEl = document.querySelector('.cartela-status');
            if (statusEl) {
                if (marcados === 24) {
                    statusEl.textContent = 'ğŸ† BINGO! (24/24)';
                    statusEl.className = 'cartela-status bingo';
                    alert('ğŸ‰ğŸ† BINGO! PARABÃ‰NS! ğŸ†ğŸ‰');
                } else if (marcados === 23) {
                    statusEl.textContent = 'ğŸ”¥ ARMADO! (23/24)';
                    statusEl.className = 'cartela-status armado';
                } else {
                    statusEl.textContent = `ğŸ¯ Teste (${marcados}/24)`;
                    statusEl.className = 'cartela-status inicio';
                }
            }
        }
        
        // ===== INICIALIZAÃ‡ÃƒO =====
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸš€ Sistema inicializado');
            verificarSistema();
        });
        
        // FunÃ§Ã£o global para logout
        function fazerLogout() {
            const login = document.getElementById('login-comprador');
            const area = document.getElementById('area-cartelas');
            
            if (area) area.style.display = 'none';
            if (login) login.style.display = 'block';
            
            // Limpar campos
            const telInput = document.getElementById('consulta-telefone');
            const emailInput = document.getElementById('consulta-email');
            if (telInput) telInput.value = '';
            if (emailInput) emailInput.value = '';
            
            console.log('ğŸšª Logout realizado');
        }
        
        function atualizarSorteio() {
            alert('ğŸ”„ Funcionalidade de atualizaÃ§Ã£o em desenvolvimento');
        }
    </script>
    
    <!-- Script principal -->
    <script src="minhas-cartelas.js"></script>
</body>
</html>
