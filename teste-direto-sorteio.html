<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽª Teste Direto - Bingo ArraiÃ¡ INEC</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>ðŸŒ½ Teste Direto - Bingo ArraiÃ¡ INEC ðŸŒ½</h1>
        <p>ðŸ”§ Teste simplificado do botÃ£o de sorteio</p>
    </header>

    <main>
        <div class="bingo-card">
            <h2>ðŸŽ¯ NÃºmero Sorteado</h2>
            <div id="numero-sorteado" class="numero-destaque">Clique em Sortear</div>
            <button id="sortear-btn">ðŸŽ² Sortear</button>
        </div>
        
        <div class="numeros-sorteados">
            <h2>ðŸ“‹ NÃºmeros Anteriores</h2>
            <div class="contador">
                <span id="contador-numeros">0</span> nÃºmeros sorteados
            </div>
            <ul id="numeros-anteriores"></ul>
        </div>
    </main>
    
    <!-- Firebase SDK v8 Compat -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script src="firebase-config.js"></script>
    <script src="firebase-service.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ðŸš€ Iniciando teste direto do botÃ£o de sorteio...');
            
            const sortearBtn = document.getElementById('sortear-btn');
            const numeroSorteadoEl = document.getElementById('numero-sorteado');
            const numerosAnterioresEl = document.getElementById('numeros-anteriores');
            const contadorEl = document.getElementById('contador-numeros');

            let numerosSorteados = [];
            let numerosDisponiveis = [];
            let configuracoes = {};

            // Verificar Firebase
            console.log('ðŸ”¥ Verificando Firebase...');
            try {
                const conexaoOk = await firebaseService.verificarConexao();
                if (!conexaoOk) {
                    throw new Error('Falha na conexÃ£o');
                }
                console.log('âœ… Firebase conectado');
            } catch (error) {
                console.error('âŒ Erro Firebase:', error);
                alert('Erro de conexÃ£o com Firebase: ' + error.message);
                return;
            }

            // Carregar dados
            console.log('ðŸ“Š Carregando dados...');
            try {
                configuracoes = await firebaseService.carregarConfiguracoes();
                numerosSorteados = await firebaseService.carregarNumerosSorteados();
                
                const numeroInicial = configuracoes.numeroInicial || 1;
                const numeroFinal = configuracoes.numeroFinal || 75;
                const todosNumeros = Array.from({ length: numeroFinal - numeroInicial + 1 }, (_, i) => i + numeroInicial);
                numerosDisponiveis = todosNumeros.filter(num => !numerosSorteados.includes(num));
                
                console.log(`âœ… Dados carregados: ${numerosSorteados.length} sorteados, ${numerosDisponiveis.length} disponÃ­veis`);
                
                // Mostrar nÃºmeros sorteados
                numerosAnterioresEl.innerHTML = '';
                numerosSorteados.forEach(numero => {
                    const li = document.createElement('li');
                    li.textContent = numero;
                    numerosAnterioresEl.appendChild(li);
                });
                
                contadorEl.textContent = numerosSorteados.length;
                
            } catch (error) {
                console.error('âŒ Erro ao carregar dados:', error);
                alert('Erro ao carregar dados: ' + error.message);
                return;
            }

            // FunÃ§Ã£o de sortear simplificada
            async function sortearNumero() {
                console.log('ðŸŽ² BotÃ£o clicado!');
                
                if (numerosDisponiveis.length === 0) {
                    console.log('âŒ Nenhum nÃºmero disponÃ­vel');
                    numeroSorteadoEl.textContent = 'FIM!';
                    sortearBtn.disabled = true;
                    sortearBtn.textContent = 'ðŸŽ‰ Acabou!';
                    return;
                }

                console.log(`ðŸ“Š ${numerosDisponiveis.length} nÃºmeros disponÃ­veis`);
                
                sortearBtn.disabled = true;
                sortearBtn.textContent = 'ðŸŽ² Sorteando...';
                
                // Sortear nÃºmero
                const randomIndex = Math.floor(Math.random() * numerosDisponiveis.length);
                const numero = numerosDisponiveis.splice(randomIndex, 1)[0];
                
                console.log(`ðŸŽ¯ NÃºmero sorteado: ${numero}`);
                
                setTimeout(async () => {
                    numerosSorteados.push(numero);
                    numeroSorteadoEl.textContent = numero;
                    
                    // Adicionar Ã  lista
                    const li = document.createElement('li');
                    li.textContent = numero;
                    numerosAnterioresEl.appendChild(li);
                    
                    // Atualizar contador
                    contadorEl.textContent = numerosSorteados.length;
                    
                    // Salvar no Firebase
                    try {
                        await firebaseService.salvarNumeroSorteado(numero);
                        console.log(`âœ… NÃºmero ${numero} salvo no Firebase`);
                    } catch (error) {
                        console.error(`âŒ Erro ao salvar: ${error.message}`);
                    }
                    
                    // Reabilitar botÃ£o
                    sortearBtn.disabled = false;
                    sortearBtn.textContent = numerosDisponiveis.length > 0 ? 
                                           'ðŸŽ¯ PrÃ³ximo NÃºmero' : 'ðŸŽ‰ Fim do Jogo!';
                    
                    if (numerosDisponiveis.length === 0) {
                        sortearBtn.disabled = true;
                    }
                    
                    console.log(`ðŸ“Š Status atualizado: ${numerosSorteados.length} sorteados, ${numerosDisponiveis.length} restantes`);
                }, 1000);
            }

            // Configurar evento
            console.log('ðŸ”§ Configurando evento do botÃ£o...');
            sortearBtn.addEventListener('click', sortearNumero);
            
            // Habilitar botÃ£o
            sortearBtn.disabled = false;
            if (numerosDisponiveis.length > 0) {
                sortearBtn.textContent = 'ðŸŽ² Sortear NÃºmero';
            } else {
                sortearBtn.textContent = 'ðŸŽ‰ Fim do Jogo!';
                sortearBtn.disabled = true;
            }
            
            console.log('âœ… Teste direto inicializado com sucesso!');
        });
    </script>
</body>
</html>
