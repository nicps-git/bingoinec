<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Sistema de Pr√™mios - Bingo Arrai√° INEC</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .teste-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .teste-secao {
            background: rgba(255, 255, 255, 0.9);
            margin: 20px 0;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .botoes-teste {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }
        
        .btn-teste {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }
        
        .btn-teste:hover {
            transform: scale(1.05);
        }
        
        .btn-teste.perigo {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }
        
        .btn-teste.info {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }
        
        .cartela-teste {
            display: inline-block;
            margin: 10px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .cartela-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 3px;
            margin: 10px 0;
        }
        
        .cartela-numero {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f0f0;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .cartela-numero.sorteado {
            background: #4CAF50;
            color: white;
        }
        
        .cartela-numero.livre {
            background: #FFD700;
            color: #333;
        }
        
        .info-cartela {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .log-teste {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="teste-container">
        <header>
            <h1>üéØ Teste Sistema de Pr√™mios</h1>
            <p>Sistema completo de QUINA e BINGO</p>
        </header>

        <div class="teste-secao">
            <h2>üîß Controles de Teste</h2>
            <div class="botoes-teste">
                <button class="btn-teste" onclick="criarCartelaTeste('quina')">üèÜ Criar Cartela QUINA</button>
                <button class="btn-teste" onclick="criarCartelaTeste('bingo')">üéâ Criar Cartela BINGO</button>
                <button class="btn-teste info" onclick="simularSorteio()">üé≤ Simular Sorteio</button>
                <button class="btn-teste info" onclick="testarVerificacaoManual()">‚úÖ Testar Verifica√ß√£o</button>
                <button class="btn-teste perigo" onclick="resetarTeste()">üîÑ Resetar Teste</button>
            </div>
        </div>

        <div class="teste-secao">
            <h2>üìä Estado Atual do Sistema</h2>
            <div id="estado-sistema">
                <p><strong>üé≤ N√∫meros Sorteados:</strong> <span id="numeros-sorteados">Nenhum</span></p>
                <p><strong>üèÜ QUINA Encontrada:</strong> <span id="quina-status">‚ùå N√£o</span></p>
                <p><strong>üéâ BINGO Encontrado:</strong> <span id="bingo-status">‚ùå N√£o</span></p>
                <p><strong>üé´ Cartelas de Teste:</strong> <span id="cartelas-teste">0</span></p>
            </div>
        </div>

        <div class="teste-secao">
            <h2>üé´ Cartelas de Teste</h2>
            <div id="cartelas-container">
                <p>Nenhuma cartela criada ainda. Use os bot√µes acima para criar cartelas de teste.</p>
            </div>
        </div>

        <div class="teste-secao">
            <h2>üìù Log de Atividades</h2>
            <div class="log-teste" id="log-atividades">
                <div>Sistema iniciado - aguardando a√ß√µes...</div>
            </div>
        </div>
    </div>

    <!-- Scripts necess√°rios -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="firebase-service.js"></script>
    <script src="script.js"></script>

    <script>
        // ===== VARI√ÅVEIS GLOBAIS DO TESTE =====
        let cartelasTeste = [];
        let numerosSorteadosTeste = [];
        let contadorCartelas = 0;

        // ===== FUN√á√ïES DE CRIA√á√ÉO DE CARTELAS TESTE =====
        
        function criarCartelaTeste(tipo) {
            contadorCartelas++;
            let cartela;
            
            if (tipo === 'quina') {
                cartela = criarCartelaQuinaPronta();
                log(`üèÜ Criada cartela QUINA (#${contadorCartelas})`);
            } else if (tipo === 'bingo') {
                cartela = criarCartelaBingoPronta();
                log(`üéâ Criada cartela BINGO (#${contadorCartelas})`);
            }
            
            cartela.id = `teste_${contadorCartelas}`;
            cartela.nome = `Teste ${contadorCartelas}`;
            cartela.telefone = `85999${String(contadorCartelas).padStart(6, '0')}`;
            cartela.vendida = true;
            
            cartelasTeste.push(cartela);
            atualizarInterface();
            renderizarCartelas();
        }
        
        function criarCartelaQuinaPronta() {
            // Cartela que ter√° quina na primeira coluna (B) com n√∫meros baixos
            const numeros = [
                // Posi√ß√µes da matriz 5x5:
                // 0  1  2  3  4    <- Linha 1
                // 5  6  7  8  9    <- Linha 2  
                // 10 11 XX 12 13   <- Linha 3 (XX = LIVRE)
                // 14 15 16 17 18   <- Linha 4
                // 19 20 21 22 23   <- Linha 5
                
                // Coluna B (posi√ß√µes 0, 5, 10, 14, 19) - todos n√∫meros baixos para quina garantida
                1,  16, 31, 46, 61,   // Coluna B: [1, 16, 31, 46, 61]
                2,  17, 32, 47, 62,   // Coluna I: [2, 17, 32, 47, 62]  
                3,  18, 33, 48,       // Coluna N: [3, 18, LIVRE, 33, 48]
                4,  19, 34, 49, 64,   // Coluna G: [4, 19, 34, 49, 64]
                5,  20, 35, 50, 65    // Coluna O: [5, 20, 35, 50, 65]
            ];
            
            return {
                numeros: numeros,
                tipo: 'quina'
            };
        }
        
        function criarCartelaBingoPronta() {
            // Cartela com todos os n√∫meros de 1 a 24 (BINGO completo)
            const numeros = [];
            for (let i = 1; i <= 24; i++) {
                numeros.push(i);
            }
            
            return {
                numeros: numeros,
                tipo: 'bingo'
            };
        }
        
        // ===== SIMULA√á√ÉO DE SORTEIO =====
        
        function simularSorteio() {
            // Simular n√∫meros para ativar quina (coluna B) e bingo
            const numerosParaQuina = [1, 16, 31, 46, 61]; // Primeira coluna (B) da cartela quina
            const numerosParaBingo = [];
            for (let i = 1; i <= 24; i++) {
                numerosParaBingo.push(i);
            }
            
            // Combinar n√∫meros (quina primeiro, depois outros n√∫meros para bingo)
            const todosNumeros = [...numerosParaQuina];
            numerosParaBingo.forEach(num => {
                if (!todosNumeros.includes(num)) {
                    todosNumeros.push(num);
                }
            });
            
            // Sortear n√∫meros gradualmente
            let contador = 0;
            const interval = setInterval(() => {
                if (contador < todosNumeros.length) {
                    const numero = todosNumeros[contador];
                    if (!numerosSorteadosTeste.includes(numero)) {
                        numerosSorteadosTeste.push(numero);
                        bingoGlobal.numerosSorteados = [...numerosSorteadosTeste];
                        
                        log(`üé≤ N√∫mero sorteado: ${numero}`);
                        
                        // Verificar pr√™mios ap√≥s cada n√∫mero
                        setTimeout(async () => {
                            await verificarPremiosTeste();
                        }, 100);
                        
                        atualizarInterface();
                        renderizarCartelas();
                    }
                    contador++;
                } else {
                    clearInterval(interval);
                    log('üéØ Simula√ß√£o de sorteio conclu√≠da');
                }
            }, 1000);
        }
        
        // ===== VERIFICA√á√ÉO MANUAL =====
        
        async function testarVerificacaoManual() {
            log('üîç Iniciando verifica√ß√£o manual de pr√™mios...');
            
            if (cartelasTeste.length === 0) {
                log('‚ö†Ô∏è Nenhuma cartela de teste encontrada');
                alert('Crie algumas cartelas de teste primeiro!');
                return;
            }
            
            await verificarPremiosTeste();
        }
        
        async function verificarPremiosTeste() {
            log('üîç Verificando pr√™mios...');
            
            for (let cartela of cartelasTeste) {
                // Verificar QUINA
                if (!premiosGlobal.quinaEncontrada) {
                    const resultadoQuina = verificarQuina(cartela.numeros, numerosSorteadosTeste);
                    if (resultadoQuina.temQuina) {
                        premiosGlobal.quinaEncontrada = true;
                        premiosGlobal.vencedorQuina = cartela;
                        
                        log(`üèÜ QUINA encontrada! Cartela: ${cartela.id}, Linha: ${resultadoQuina.linha}`);
                        anunciarQuina(cartela, resultadoQuina);
                        break;
                    }
                }
                
                // Verificar BINGO
                if (!premiosGlobal.bingoEncontrado) {
                    const resultadoBingo = verificarBingo(cartela.numeros, numerosSorteadosTeste);
                    if (resultadoBingo.temBingo) {
                        premiosGlobal.bingoEncontrado = true;
                        premiosGlobal.vencedorBingo = cartela;
                        
                        log(`üéâ BINGO encontrado! Cartela: ${cartela.id}, N√∫meros: ${resultadoBingo.numerosCompletos}/24`);
                        anunciarBingo(cartela, resultadoBingo);
                        break;
                    }
                }
            }
            
            atualizarInterface();
        }
        
        // ===== RESET DO TESTE =====
        
        function resetarTeste() {
            cartelasTeste = [];
            numerosSorteadosTeste = [];
            contadorCartelas = 0;
            
            // Reset do estado global
            premiosGlobal.quinaEncontrada = false;
            premiosGlobal.bingoEncontrado = false;
            premiosGlobal.vencedorQuina = null;
            premiosGlobal.vencedorBingo = null;
            
            bingoGlobal.numerosSorteados = [];
            
            log('üîÑ Teste resetado completamente');
            atualizarInterface();
            renderizarCartelas();
        }
        
        // ===== INTERFACE E LOGS =====
        
        function atualizarInterface() {
            document.getElementById('numeros-sorteados').textContent = 
                numerosSorteadosTeste.length > 0 ? numerosSorteadosTeste.join(', ') : 'Nenhum';
            
            document.getElementById('quina-status').textContent = 
                premiosGlobal.quinaEncontrada ? '‚úÖ Sim' : '‚ùå N√£o';
            
            document.getElementById('bingo-status').textContent = 
                premiosGlobal.bingoEncontrado ? '‚úÖ Sim' : '‚ùå N√£o';
            
            document.getElementById('cartelas-teste').textContent = cartelasTeste.length;
        }
        
        function renderizarCartelas() {
            const container = document.getElementById('cartelas-container');
            
            if (cartelasTeste.length === 0) {
                container.innerHTML = '<p>Nenhuma cartela criada ainda. Use os bot√µes acima para criar cartelas de teste.</p>';
                return;
            }
            
            container.innerHTML = '';
            
            cartelasTeste.forEach(cartela => {
                const cartelaDiv = document.createElement('div');
                cartelaDiv.className = 'cartela-teste';
                
                let numerosCompletos = 0;
                let temQuina = false;
                
                // Verificar status da cartela
                const resultadoQuina = verificarQuina(cartela.numeros, numerosSorteadosTeste);
                const resultadoBingo = verificarBingo(cartela.numeros, numerosSorteadosTeste);
                
                numerosCompletos = resultadoBingo.numerosCompletos;
                temQuina = resultadoQuina.temQuina;
                
                cartelaDiv.innerHTML = `
                    <h4>Cartela ${cartela.id}</h4>
                    <div class="cartela-grid">
                        ${renderizarNumerosCartela(cartela.numeros)}
                    </div>
                    <div class="info-cartela">
                        <div><strong>Comprador:</strong> ${cartela.nome}</div>
                        <div><strong>Telefone:</strong> ${cartela.telefone}</div>
                        <div><strong>N√∫meros marcados:</strong> ${numerosCompletos}/24</div>
                        <div><strong>Status:</strong> ${temQuina ? 'üèÜ QUINA!' : resultadoBingo.temBingo ? 'üéâ BINGO!' : 'üìù Jogando'}</div>
                    </div>
                `;
                
                container.appendChild(cartelaDiv);
            });
        }
        
        function renderizarNumerosCartela(numeros) {
            const grid = [];
            
            // Primeira linha
            for (let i = 0; i < 5; i++) {
                const numero = numeros[i];
                const sorteado = numerosSorteadosTeste.includes(numero);
                grid.push(`<div class="cartela-numero ${sorteado ? 'sorteado' : ''}">${numero}</div>`);
            }
            
            // Segunda linha
            for (let i = 5; i < 10; i++) {
                const numero = numeros[i];
                const sorteado = numerosSorteadosTeste.includes(numero);
                grid.push(`<div class="cartela-numero ${sorteado ? 'sorteado' : ''}">${numero}</div>`);
            }
            
            // Terceira linha (com espa√ßo livre)
            for (let i = 10; i < 12; i++) {
                const numero = numeros[i];
                const sorteado = numerosSorteadosTeste.includes(numero);
                grid.push(`<div class="cartela-numero ${sorteado ? 'sorteado' : ''}">${numero}</div>`);
            }
            grid.push('<div class="cartela-numero livre">LIVRE</div>');
            for (let i = 12; i < 14; i++) {
                const numero = numeros[i];
                const sorteado = numerosSorteadosTeste.includes(numero);
                grid.push(`<div class="cartela-numero ${sorteado ? 'sorteado' : ''}">${numero}</div>`);
            }
            
            // Quarta linha
            for (let i = 14; i < 19; i++) {
                const numero = numeros[i];
                const sorteado = numerosSorteadosTeste.includes(numero);
                grid.push(`<div class="cartela-numero ${sorteado ? 'sorteado' : ''}">${numero}</div>`);
            }
            
            // Quinta linha
            for (let i = 19; i < 24; i++) {
                const numero = numeros[i];
                const sorteado = numerosSorteadosTeste.includes(numero);
                grid.push(`<div class="cartela-numero ${sorteado ? 'sorteado' : ''}">${numero}</div>`);
            }
            
            return grid.join('');
        }
        
        function log(mensagem) {
            const logContainer = document.getElementById('log-atividades');
            const timestamp = new Date().toLocaleTimeString();
            const logLine = document.createElement('div');
            logLine.innerHTML = `<strong>${timestamp}</strong> - ${mensagem}`;
            logContainer.appendChild(logLine);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // ===== INICIALIZA√á√ÉO =====
        
        document.addEventListener('DOMContentLoaded', function() {
            log('‚úÖ Sistema de teste carregado');
            atualizarInterface();
            
            // Aguardar script.js carregar
            setTimeout(() => {
                if (typeof premiosGlobal !== 'undefined') {
                    log('‚úÖ Sistema de pr√™mios conectado');
                } else {
                    log('‚ö†Ô∏è Sistema de pr√™mios n√£o encontrado');
                }
            }, 1000);
        });
    </script>
</body>
</html>
