<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Direto Firebase - Bypass Sistema</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(45deg, #E3F2FD, #BBDEFB);
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        .success { border-color: #4CAF50; background: #f8fff8; }
        .error { border-color: #f44336; background: #fff8f8; }
        .warning { border-color: #FF9800; background: #fff8e1; }
        button {
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        .btn-test { background: #2196F3; color: white; }
        .btn-direct { background: #4CAF50; color: white; }
        .btn-danger { background: #f44336; color: white; }
        .log {
            background: #1e1e1e;
            color: #00ff41;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste Direto Firebase - Bypass Sistema</h1>
        <p>Este teste ignora completamente o sistema e testa o Firebase diretamente</p>
        
        <div class="test-section">
            <h3>üî• Testes Diretos</h3>
            <button class="btn-test" onclick="testeFirebaseSDK()">1. Testar SDK B√°sico</button>
            <button class="btn-test" onclick="testeInicializacaoManual()">2. Inicializa√ß√£o Manual</button>
            <button class="btn-direct" onclick="testeGravacaoDireta()">3. Grava√ß√£o Direta (sem sistema)</button>
            <button class="btn-direct" onclick="testeCartelaModelo()">4. Cartela com Modelo Exato</button>
            <button class="btn-danger" onclick="limparLogs()">Limpar Logs</button>
        </div>
        
        <div class="test-section">
            <h3>üìä Console de Debug</h3>
            <div id="log-output" class="log">Aguardando testes...</div>
        </div>
    </div>

    <!-- Firebase SDK v8 Compat -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
    <script>
        let logs = [];
        
        // Configura√ß√£o Firebase (copiada do firebase-config.js)
        const firebaseConfig = {
          apiKey: "AIzaSyC7CnYV9gkczJ8zIcmTLrvQlrFFKNVhJNw",
          authDomain: "bingoinec.firebaseapp.com",
          projectId: "bingoinec",
          storageBucket: "bingoinec.firebasestorage.app",
          messagingSenderId: "483007152008",
          appId: "1:483007152008:web:6347c02216e162c0a3c43d"
        };
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const icon = {
                'success': '‚úÖ',
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è',
                'info': '‚ÑπÔ∏è'
            }[type] || '‚ÑπÔ∏è';
            
            const logMessage = `[${timestamp}] ${icon} ${message}`;
            logs.push(logMessage);
            
            console.log(logMessage);
            
            const logDiv = document.getElementById('log-output');
            logDiv.textContent = logs.join('\n');
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function limparLogs() {
            logs = [];
            document.getElementById('log-output').textContent = 'Logs limpos...';
        }
        
        async function testeFirebaseSDK() {
            log('üî• === TESTE 1: SDK B√ÅSICO ===');
            
            try {
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebase SDK n√£o carregado');
                }
                
                log(`SDK Firebase detectado: v${firebase.SDK_VERSION || 'desconhecida'}`, 'success');
                log(`Apps inicializados: ${firebase.apps.length}`);
                
                // Verificar se Firestore est√° dispon√≠vel
                if (typeof firebase.firestore === 'function') {
                    log('Firestore dispon√≠vel', 'success');
                } else {
                    log('Firestore N√ÉO dispon√≠vel', 'error');
                }
                
                log('Teste SDK conclu√≠do', 'success');
                
            } catch (error) {
                log(`Erro no teste SDK: ${error.message}`, 'error');
            }
        }
        
        async function testeInicializacaoManual() {
            log('‚öôÔ∏è === TESTE 2: INICIALIZA√á√ÉO MANUAL ===');
            
            try {
                // Tentar inicializar app manualmente
                let app;
                try {
                    app = firebase.app(); // Verificar se j√° existe
                    log('App Firebase j√° existe', 'info');
                } catch {
                    app = firebase.initializeApp(firebaseConfig);
                    log('Nova app Firebase criada', 'success');
                }
                
                log(`Nome da app: ${app.name}`);
                log(`Projeto ID: ${app.options.projectId}`);
                
                // Testar Firestore
                const db = firebase.firestore();
                log('Inst√¢ncia Firestore criada', 'success');
                
                // Teste de configura√ß√£o
                const settings = db._settings || {};
                log(`Host Firestore: ${settings.host || 'padr√£o'}`);
                
                log('Inicializa√ß√£o manual conclu√≠da', 'success');
                
            } catch (error) {
                log(`Erro na inicializa√ß√£o: ${error.message}`, 'error');
            }
        }
        
        async function testeGravacaoDireta() {
            log('üíæ === TESTE 3: GRAVA√á√ÉO DIRETA ===');
            
            try {
                const db = firebase.firestore();
                
                const dadosTeste = {
                    teste: 'gravacao-direta',
                    timestamp: Date.now(),
                    timestampServer: firebase.firestore.FieldValue.serverTimestamp(),
                    data: new Date(),
                    numero: Math.floor(Math.random() * 1000),
                    objeto: {
                        propriedade1: 'valor1',
                        propriedade2: 123
                    },
                    array: [1, 2, 3, 'teste']
                };
                
                log('Dados preparados para grava√ß√£o direta');
                log(`ID do teste: ${dadosTeste.numero}`);
                
                // Gravar diretamente
                const docRef = await db.collection('teste-direto').add(dadosTeste);
                log(`GRAVA√á√ÉO DIRETA REALIZADA! Doc ID: ${docRef.id}`, 'success');
                
                // Verificar imediatamente
                const doc = await docRef.get();
                if (doc.exists) {
                    log('Verifica√ß√£o: documento gravado com sucesso', 'success');
                    const data = doc.data();
                    log(`Campos gravados: ${Object.keys(data).join(', ')}`);
                } else {
                    log('Verifica√ß√£o: documento N√ÉO encontrado', 'error');
                }
                
            } catch (error) {
                log(`ERRO na grava√ß√£o direta: ${error.message}`, 'error');
                log(`C√≥digo do erro: ${error.code || 'nenhum'}`, 'error');
                log(`Stack: ${error.stack}`, 'error');
            }
        }
        
        async function testeCartelaModelo() {
            log('üéØ === TESTE 4: CARTELA MODELO EXATO ===');
            
            try {
                const db = firebase.firestore();
                
                // Cartela com o modelo EXATO especificado
                const cartelaModelo = {
                    id: `CART-${Date.now()}-${Math.floor(Math.random() * 1000)}`,
                    numeros: [1, 16, 31, 46, 61, 2, 17, 32, 47, 62, 3, 18, 33, 48, 63],
                    preco: 5.00,
                    status: "vendida",
                    comprador: {
                        nome: "Teste Modelo Exato",
                        telefone: "11999999999"
                    },
                    nome: "Teste Modelo Exato",
                    telefone: "11999999999",
                    dataCompra: new Date(),
                    timestamp: Date.now(),
                    timestampFirebase: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                log('Cartela modelo preparada:');
                log(`- ID: ${cartelaModelo.id}`);
                log(`- N√∫meros: ${cartelaModelo.numeros.join(', ')}`);
                log(`- Pre√ßo: R$ ${cartelaModelo.preco}`);
                log(`- Status: ${cartelaModelo.status}`);
                log(`- Comprador: ${cartelaModelo.comprador.nome} (${cartelaModelo.comprador.telefone})`);
                
                // Gravar cartela na cole√ß√£o 'cartelas'
                const docRef = await db.collection('cartelas').add(cartelaModelo);
                log(`CARTELA SALVA COM SUCESSO! Firebase ID: ${docRef.id}`, 'success');
                
                // Verificar se foi salva corretamente
                const doc = await docRef.get();
                if (doc.exists) {
                    log('Verifica√ß√£o: cartela existe no banco', 'success');
                    const data = doc.data();
                    
                    // Verificar cada campo
                    log('Verificando campos salvos:');
                    log(`‚úì id: ${data.id}`);
                    log(`‚úì numeros (${data.numeros?.length} itens): ${data.numeros?.join(', ')}`);
                    log(`‚úì preco: ${data.preco}`);
                    log(`‚úì status: ${data.status}`);
                    log(`‚úì comprador.nome: ${data.comprador?.nome}`);
                    log(`‚úì comprador.telefone: ${data.comprador?.telefone}`);
                    log(`‚úì nome: ${data.nome}`);
                    log(`‚úì telefone: ${data.telefone}`);
                    log(`‚úì dataCompra: ${data.dataCompra}`);
                    log(`‚úì timestamp: ${data.timestamp}`);
                    log(`‚úì timestampFirebase: ${data.timestampFirebase ? 'OK' : 'AUSENTE'}`);
                    
                    log('MODELO VERIFICADO: TODOS OS CAMPOS PRESENTES!', 'success');
                    
                } else {
                    log('Verifica√ß√£o: cartela N√ÉO encontrada no banco', 'error');
                }
                
            } catch (error) {
                log(`ERRO ao testar cartela modelo: ${error.message}`, 'error');
                log(`C√≥digo: ${error.code || 'nenhum'}`, 'error');
                if (error.stack) {
                    log(`Stack: ${error.stack}`, 'error');
                }
            }
        }
        
        // Auto-start
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('üöÄ Sistema de teste direto carregado');
                log('Execute os testes na ordem para diagnosticar o problema');
            }, 1000);
        });
    </script>
</body>
</html>
