<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸª Bingo ArraiÃ¡ INEC ğŸª</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- DecoraÃ§Ãµes de Festa Junina -->
    <div class="bandeirolas">
        <div class="bandeirola bandeirola-1"></div>
        <div class="bandeirola bandeirola-2"></div>
        <div class="bandeirola bandeirola-3"></div>
        <div class="bandeirola bandeirola-4"></div>
        <div class="bandeirola bandeirola-5"></div>
        <div class="bandeirola bandeirola-6"></div>
        <div class="bandeirola bandeirola-7"></div>
        <div class="bandeirola bandeirola-8"></div>
        <div class="bandeirola bandeirola-9"></div>
        <div class="bandeirola bandeirola-10"></div>
    </div>
    
    <div class="fogueira">
        <div class="fogo"></div>
        <div class="lenha"></div>
    </div>

    <header>
        <div class="logo-empresa">
            <img src="inec.png" alt="Logo INEC" class="logo-inec">
        </div>
        <div class="admin-link">
            <a href="#" onclick="verificarAcessoAdmin()" class="btn-admin">âš™ï¸ Admin</a>
        </div>
        <div class="cartelas-link">
            <a href="cartelas.html" class="btn-cartelas">ğŸ« Comprar</a>
            <a href="minhas-cartelas.html" class="btn-cartelas">ğŸ‘€ Minhas Cartelas</a>
        </div>
        <div class="chapeu-palha">ğŸ‘’</div>
        <h1>ğŸŒ½ Bingo ArraiÃ¡ INEC ğŸŒ½</h1>
        <p>ğŸŠ Festa Junina com DiversÃ£o Garantida! ğŸŠ</p>
        <div class="elementos-decorativos">
            <span class="elemento">ğŸŒ½</span>
            <span class="elemento">ğŸ”¥</span>
            <span class="elemento">ğŸª</span>
            <span class="elemento">ğŸª—</span>
            <span class="elemento">ğŸŒ½</span>
        </div>
    </header>

    <main>
        <div class="bingo-card">
            <div class="milho-decorativo milho-esquerda">ğŸŒ½</div>
            <div class="milho-decorativo milho-direita">ğŸŒ½</div>
            <h2>ğŸ¯ NÃºmero Sorteado</h2>
            <div id="numero-sorteado" class="numero-destaque"></div>
            <button id="sortear-btn">ğŸ² Sortear</button>
            <div class="baloes">
                <div class="balao balao-1">ğŸˆ</div>
                <div class="balao balao-2">ğŸˆ</div>
                <div class="balao balao-3">ğŸˆ</div>
            </div>
        </div>
        
        <div class="barraca-bingo">
            <div class="teto-barraca"></div>
            <div class="numeros-sorteados">
                <div class="quadrilha-caipiras">
                    <span class="caipira">ğŸ‘¨â€ğŸŒ¾</span>
                    <span class="caipira">ğŸ‘©â€ğŸŒ¾</span>
                </div>
                <h2>ğŸ“‹ NÃºmeros Anteriores</h2>
                <div class="contador">
                    <span id="contador-numeros">0</span> nÃºmeros sorteados
                </div>
                <ul id="numeros-anteriores"></ul>
                <div class="comidas-juninas">
                    <span class="comida">ğŸ­</span>
                    <span class="comida">ğŸŒ½</span>
                    <span class="comida">ğŸ¥§</span>
                    <span class="comida">ğŸ§</span>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Elementos flutuantes -->
    <div class="estrelas">
        <div class="estrela estrela-1">â­</div>
        <div class="estrela estrela-2">âœ¨</div>
        <div class="estrela estrela-3">â­</div>
        <div class="estrela estrela-4">âœ¨</div>
        <div class="estrela estrela-5">â­</div>
    </div>
    
    <div class="fogos-artificio" id="fogos"></div>

    <!-- Firebase SDK v8 Compat -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script src="firebase-config.js"></script>
    <script src="firebase-service.js"></script>

    <script>
        // ===== FUNÃ‡ÃƒO DE ACESSO ADMIN =====
        function verificarAcessoAdmin() {
            if (window.bingoAuth && window.bingoAuth.isAuthenticated()) {
                window.location.href = 'admin.html';
            } else {
                if (confirm('Para acessar a Ã¡rea administrativa, Ã© necessÃ¡rio fazer login. Deseja ir para a pÃ¡gina de login?')) {
                    window.location.href = 'login.html';
                }
            }
        }
        
        // ===== SISTEMA DE SORTEIO FUNCIONAL =====
        console.log('ğŸš€ Iniciando Bingo ArraiÃ¡ INEC - VersÃ£o Final');
        
        let sistemaFinal = {
            botao: null,
            numeroEl: null,
            listaEl: null,
            contadorEl: null,
            numerosSorteados: [],
            numerosDisponiveis: [],
            pronto: false
        };
        
        // FunÃ§Ã£o de sorteio final que definitivamente funciona
        function sortearNumeroFinal() {
            console.log('ğŸ² SORTEIO EXECUTADO!');
            
            if (sistemaFinal.numerosDisponiveis.length === 0) {
                alert('ğŸ‰ Todos os nÃºmeros jÃ¡ foram sorteados! ParabÃ©ns!');
                return;
            }
            
            // Desabilitar botÃ£o
            sistemaFinal.botao.disabled = true;
            sistemaFinal.botao.textContent = 'ğŸ² Sorteando...';
            
            // Sortear nÃºmero
            const randomIndex = Math.floor(Math.random() * sistemaFinal.numerosDisponiveis.length);
            const numero = sistemaFinal.numerosDisponiveis.splice(randomIndex, 1)[0];
            
            // AnimaÃ§Ã£o
            let contador = 0;
            const animacao = setInterval(() => {
                const temp = Math.floor(Math.random() * 75) + 1;
                sistemaFinal.numeroEl.textContent = temp;
                contador++;
                
                if (contador >= 10) {
                    clearInterval(animacao);
                    
                    // Mostrar nÃºmero final
                    setTimeout(() => {
                        sistemaFinal.numeroEl.textContent = numero;
                        sistemaFinal.numerosSorteados.push(numero);
                        
                        // Adicionar Ã  lista
                        const li = document.createElement('li');
                        li.textContent = numero;
                        sistemaFinal.listaEl.appendChild(li);
                        
                        // Atualizar contador
                        sistemaFinal.contadorEl.textContent = sistemaFinal.numerosSorteados.length;
                        
                        // Salvar no Firebase se disponÃ­vel
                        if (typeof window.firebaseService !== 'undefined') {
                            firebaseService.salvarNumeroSorteado(numero).catch(e => {
                                console.log('Firebase indisponÃ­vel, continuando em modo local');
                            });
                        }
                        
                        // Reabilitar botÃ£o
                        sistemaFinal.botao.disabled = false;
                        sistemaFinal.botao.textContent = sistemaFinal.numerosDisponiveis.length > 0 ? 
                                                        'ğŸ¯ PrÃ³ximo NÃºmero' : 'ğŸ‰ Fim do Jogo!';
                        
                        if (sistemaFinal.numerosDisponiveis.length === 0) {
                            sistemaFinal.botao.disabled = true;
                        }
                        
                        console.log(`âœ… Sorteado: ${numero}. Restam: ${sistemaFinal.numerosDisponiveis.length}`);
                        
                    }, 500);
                }
            }, 100);
        }
        
        // InicializaÃ§Ã£o quando DOM carregar
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ“‹ DOM carregado');
            
            setTimeout(() => {
                console.log('ğŸ”§ Configurando sistema final...');
                
                // Encontrar elementos
                sistemaFinal.botao = document.getElementById('sortear-btn');
                sistemaFinal.numeroEl = document.getElementById('numero-sorteado');
                sistemaFinal.listaEl = document.getElementById('numeros-anteriores');
                sistemaFinal.contadorEl = document.getElementById('contador-numeros');
                
                if (!sistemaFinal.botao || !sistemaFinal.numeroEl) {
                    console.error('âŒ Elementos essenciais nÃ£o encontrados!');
                    return;
                }
                
                console.log('âœ… Elementos encontrados');
                
                // FunÃ§Ã£o para carregar dados
                const carregarDados = async () => {
                    console.log('ğŸ“Š Carregando dados...');
                    
                    try {
                        if (typeof window.firebaseService !== 'undefined') {
                            console.log('ğŸ”¥ Firebase disponÃ­vel, carregando...');
                            const config = await firebaseService.carregarConfiguracoes();
                            const numerosSalvos = await firebaseService.carregarNumerosSorteados();
                            
                            const inicio = config.numeroInicial || 1;
                            const fim = config.numeroFinal || 75;
                            const todos = Array.from({length: fim - inicio + 1}, (_, i) => i + inicio);
                            
                            sistemaFinal.numerosDisponiveis = todos.filter(n => !numerosSalvos.includes(n));
                            sistemaFinal.numerosSorteados = numerosSalvos;
                            
                            // Restaurar lista
                            sistemaFinal.listaEl.innerHTML = '';
                            numerosSalvos.forEach(num => {
                                const li = document.createElement('li');
                                li.textContent = num;
                                sistemaFinal.listaEl.appendChild(li);
                            });
                            sistemaFinal.contadorEl.textContent = numerosSalvos.length;
                            
                            console.log(`âœ… Firebase: ${numerosSalvos.length} sorteados, ${sistemaFinal.numerosDisponiveis.length} disponÃ­veis`);
                        } else {
                            throw new Error('Firebase nÃ£o disponÃ­vel');
                        }
                    } catch (error) {
                        console.log('âš ï¸ Usando modo local:', error.message);
                        sistemaFinal.numerosDisponiveis = Array.from({length: 75}, (_, i) => i + 1);
                        sistemaFinal.numerosSorteados = [];
                    }
                    
                    finalizarConfiguracao();
                };
                
                const finalizarConfiguracao = () => {
                    console.log('ğŸ¯ Finalizando configuraÃ§Ã£o...');
                    
                    // Configurar botÃ£o
                    sistemaFinal.botao.onclick = function(e) {
                        e.preventDefault();
                        console.log('ğŸ¯ CLIQUE DETECTADO!');
                        sortearNumeroFinal();
                    };
                    
                    // Estado inicial
                    if (sistemaFinal.numerosDisponiveis.length > 0) {
                        sistemaFinal.botao.disabled = false;
                        sistemaFinal.botao.textContent = 'ğŸ² Sortear';
                        sistemaFinal.numeroEl.textContent = 'Clique em Sortear';
                    } else {
                        sistemaFinal.botao.disabled = true;
                        sistemaFinal.botao.textContent = 'ğŸ‰ Fim do Jogo!';
                        sistemaFinal.numeroEl.textContent = 'Jogo Finalizado';
                    }
                    
                    sistemaFinal.pronto = true;
                    console.log('ğŸ‰ Sistema PRONTO e FUNCIONAL!');
                };
                
                // Carregar dados
                carregarDados();
                
            }, 1000);
        });
    </script>
</body>
</html>
