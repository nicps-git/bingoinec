<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Completo Firebase - Bingo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
        }
        .buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        .btn-success { background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); }
        .btn-warning { background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%); }
        .btn-danger { background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%); }
        .btn-info { background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%); }
        
        .result {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            white-space: pre-wrap;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            max-height: 500px;
            overflow-y: auto;
            line-height: 1.5;
        }
        .success { background: #f0fff4; border-color: #9ae6b4; color: #276749; }
        .error { background: #fed7d7; border-color: #feb2b2; color: #742a2a; }
        .info { background: #ebf8ff; border-color: #90cdf4; color: #2a4365; }
        .warning { background: #fffbeb; border-color: #f6e05e; color: #744210; }
        
        .status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin: 5px;
        }
        .online { background: #48bb78; color: white; }
        .offline { background: #f56565; color: white; }
        .loading { background: #ed8936; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• Debug Completo Firebase - Sistema Bingo</h1>
        
        <div class="status-bar" style="text-align: center; margin-bottom: 20px;">
            <span id="status-firebase" class="status loading">üîÑ Verificando Firebase...</span>
            <span id="status-conexao" class="status loading">üåê Testando Conex√£o...</span>
        </div>
        
        <div class="buttons">
            <button class="btn" onclick="testarConexaoCompleta()">üîå Teste Completo</button>
            <button class="btn btn-success" onclick="buscarTodosNumeros()">üé≤ Buscar N√∫meros</button>
            <button class="btn btn-info" onclick="buscarCartelas()">üé´ Buscar Cartelas</button>
            <button class="btn btn-warning" onclick="explorarEstrutura()">üìÇ Explorar Estrutura</button>
            <button class="btn btn-danger" onclick="limparTudo()">üóëÔ∏è Limpar</button>
        </div>
        
        <div id="resultado" class="result">
Aguardando comandos... üöÄ

üí° Dicas:
- Use "Teste Completo" para verificar tudo
- "Buscar N√∫meros" testa especificamente os n√∫meros sorteados
- "Explorar Estrutura" mostra todas as cole√ß√µes e documentos
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="firebase-config.js"></script>

    <script>
        let logContainer = document.getElementById('resultado');
        let logCount = 0;
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            
            console.log(message);
            
            if (logContainer) {
                logContainer.textContent += logMessage;
                logContainer.className = `result ${type}`;
                logContainer.scrollTop = logContainer.scrollHeight;
            }
            
            logCount++;
        }
        
        function limparTudo() {
            if (logContainer) {
                logContainer.textContent = 'Log limpo! üßπ\n\n';
                logContainer.className = 'result';
            }
            logCount = 0;
        }
        
        function updateStatus(elementId, status, text) {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `status ${status}`;
                element.textContent = text;
            }
        }
        
        async function testarConexaoCompleta() {
            log('üöÄ === INICIANDO TESTE COMPLETO ===', 'info');
            
            try {
                updateStatus('status-firebase', 'loading', 'üîÑ Testando Firebase...');
                
                // 1. Verificar Firebase SDK
                if (typeof firebase === 'undefined') {
                    log('‚ùå Firebase SDK n√£o carregado!', 'error');
                    updateStatus('status-firebase', 'offline', '‚ùå SDK n√£o carregado');
                    return;
                }
                log('‚úÖ Firebase SDK carregado');
                
                // 2. Inicializar Firebase
                if (!firebase.apps.length) {
                    if (window.firebaseConfig) {
                        firebase.initializeApp(window.firebaseConfig);
                        log('‚úÖ Firebase inicializado');
                    } else {
                        log('‚ùå Configura√ß√£o do Firebase n√£o encontrada!', 'error');
                        updateStatus('status-firebase', 'offline', '‚ùå Config n√£o encontrada');
                        return;
                    }
                } else {
                    log('‚úÖ Firebase j√° inicializado');
                }
                
                updateStatus('status-firebase', 'online', '‚úÖ Firebase OK');
                
                // 3. Testar Firestore
                updateStatus('status-conexao', 'loading', 'üîÑ Testando Firestore...');
                const db = firebase.firestore();
                log('‚úÖ Firestore conectado');
                
                // 4. Teste de conectividade
                const testRef = db.collection('test').doc('connectivity');
                await testRef.set({ timestamp: firebase.firestore.FieldValue.serverTimestamp() });
                log('‚úÖ Teste de escrita bem-sucedido');
                
                const testDoc = await testRef.get();
                if (testDoc.exists) {
                    log('‚úÖ Teste de leitura bem-sucedido');
                } else {
                    log('‚ö†Ô∏è Documento de teste n√£o encontrado ap√≥s escrita');
                }
                
                // Limpar teste
                await testRef.delete();
                log('‚úÖ Limpeza do teste conclu√≠da');
                
                updateStatus('status-conexao', 'online', '‚úÖ Conex√£o OK');
                
                log('üéâ TESTE COMPLETO CONCLU√çDO COM SUCESSO!', 'success');
                
            } catch (error) {
                log(`‚ùå ERRO no teste completo: ${error.message}`, 'error');
                updateStatus('status-firebase', 'offline', '‚ùå Erro');
                updateStatus('status-conexao', 'offline', '‚ùå Erro');
                console.error('Erro completo:', error);
            }
        }
        
        async function buscarTodosNumeros() {
            log('üé≤ === BUSCANDO TODOS OS N√öMEROS SORTEADOS ===', 'info');
            
            try {
                const db = firebase.firestore();
                
                // Estrat√©gia 1: M√©todo exato do firebase-service.js
                log('üéØ Estrat√©gia 1: "numeros-sorteados" com orderBy("dataSorteio")');
                try {
                    const snapshot1 = await db.collection('numeros-sorteados').orderBy('dataSorteio', 'asc').get();
                    log(`üìä Encontrados ${snapshot1.size} documentos`);
                    
                    if (snapshot1.size > 0) {
                        const numeros1 = [];
                        snapshot1.forEach(doc => {
                            const data = doc.data();
                            log(`   üìÑ ID: ${doc.id}`);
                            log(`   üìã Data: ${JSON.stringify(data, null, 2)}`);
                            if (data.numero !== undefined) {
                                numeros1.push(data.numero);
                            }
                        });
                        
                        if (numeros1.length > 0) {
                            log(`‚úÖ SUCESSO! Encontrados ${numeros1.length} n√∫meros:`, 'success');
                            log(`üéØ N√∫meros: ${numeros1.join(', ')}`, 'success');
                            return numeros1;
                        }
                    }
                } catch (err) {
                    log(`‚ùå Estrat√©gia 1 falhou: ${err.message}`, 'error');
                }
                
                // Estrat√©gia 2: Sem orderBy
                log('üîÑ Estrat√©gia 2: "numeros-sorteados" sem orderBy');
                try {
                    const snapshot2 = await db.collection('numeros-sorteados').get();
                    log(`üìä Encontrados ${snapshot2.size} documentos`);
                    
                    if (snapshot2.size > 0) {
                        const numeros2 = [];
                        snapshot2.forEach(doc => {
                            const data = doc.data();
                            log(`   üìÑ ID: ${doc.id}, Data: ${JSON.stringify(data)}`);
                            if (data.numero !== undefined) {
                                numeros2.push(data.numero);
                            }
                        });
                        
                        if (numeros2.length > 0) {
                            log(`‚úÖ SUCESSO ESTRAT√âGIA 2! ${numeros2.length} n√∫meros:`, 'success');
                            log(`üéØ N√∫meros: ${numeros2.join(', ')}`, 'success');
                            return numeros2;
                        }
                    }
                } catch (err) {
                    log(`‚ùå Estrat√©gia 2 falhou: ${err.message}`, 'error');
                }
                
                // Estrat√©gia 3: Outras cole√ß√µes
                const outrasColecoes = ['numerosSorteados', 'sorteio', 'bingo-sorteio', 'sorteados'];
                for (const colecao of outrasColecoes) {
                    log(`üîç Estrat√©gia 3: Testando "${colecao}"`);
                    try {
                        const snapshot = await db.collection(colecao).get();
                        log(`üìä "${colecao}": ${snapshot.size} documentos`);
                        
                        if (snapshot.size > 0) {
                            snapshot.forEach(doc => {
                                const data = doc.data();
                                log(`   üìÑ ${colecao}/${doc.id}: ${JSON.stringify(data)}`);
                            });
                        }
                    } catch (err) {
                        log(`‚ùå Erro em "${colecao}": ${err.message}`);
                    }
                }
                
                log('‚ùå NENHUM N√öMERO ENCONTRADO', 'error');
                
            } catch (error) {
                log(`‚ùå ERRO GERAL: ${error.message}`, 'error');
            }
        }
        
        async function buscarCartelas() {
            log('üé´ === BUSCANDO CARTELAS ===', 'info');
            
            try {
                const db = firebase.firestore();
                
                const snapshot = await db.collection('cartelas').limit(5).get();
                log(`üìä Encontradas ${snapshot.size} cartelas (amostra)`);
                
                if (snapshot.size > 0) {
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        log(`üìÑ Cartela ID: ${doc.id}`);
                        log(`üìã Dados: ${JSON.stringify(data, null, 2)}`);
                        log('---');
                    });
                } else {
                    log('‚ùå Nenhuma cartela encontrada', 'error');
                }
                
            } catch (error) {
                log(`‚ùå Erro ao buscar cartelas: ${error.message}`, 'error');
            }
        }
        
        async function explorarEstrutura() {
            log('üìÇ === EXPLORANDO ESTRUTURA COMPLETA ===', 'info');
            
            try {
                const db = firebase.firestore();
                
                // Lista de cole√ß√µes para testar
                const colecoes = [
                    'cartelas',
                    'numeros-sorteados',
                    'numerosSorteados',
                    'configuracoes',
                    'sorteio',
                    'bingo-sorteio',
                    'alertas',
                    'usuarios'
                ];
                
                for (const colecao of colecoes) {
                    log(`üîç Explorando cole√ß√£o: "${colecao}"`);
                    
                    try {
                        const snapshot = await db.collection(colecao).limit(3).get();
                        log(`üìä "${colecao}": ${snapshot.size} documentos (amostra)`);
                        
                        if (snapshot.size > 0) {
                            snapshot.forEach(doc => {
                                const data = doc.data();
                                log(`   üìÑ ${doc.id}: ${JSON.stringify(data, null, 2)}`);
                            });
                        }
                        log('');
                        
                    } catch (err) {
                        log(`‚ùå Erro em "${colecao}": ${err.message}`);
                    }
                }
                
                // Testar documentos espec√≠ficos
                log('üéØ Testando documentos espec√≠ficos...');
                const docsEspecificos = [
                    'bingo/sorteio',
                    'configuracoes/bingo',
                    'configuracoes/main'
                ];
                
                for (const docPath of docsEspecificos) {
                    try {
                        const doc = await db.doc(docPath).get();
                        if (doc.exists) {
                            log(`‚úÖ Documento "${docPath}" encontrado:`);
                            log(`üìã ${JSON.stringify(doc.data(), null, 2)}`);
                        } else {
                            log(`‚ö†Ô∏è Documento "${docPath}" n√£o existe`);
                        }
                    } catch (err) {
                        log(`‚ùå Erro em "${docPath}": ${err.message}`);
                    }
                }
                
                log('‚úÖ EXPLORA√á√ÉO COMPLETA CONCLU√çDA!', 'success');
                
            } catch (error) {
                log(`‚ùå Erro na explora√ß√£o: ${error.message}`, 'error');
            }
        }
        
        // Inicializa√ß√£o autom√°tica
        window.onload = function() {
            log('üåü Sistema de Debug Firebase Inicializado!', 'info');
            log('üí° Use os bot√µes acima para explorar o Firebase');
            log('');
            
            // Teste inicial autom√°tico
            setTimeout(testarConexaoCompleta, 1000);
        };
    </script>
</body>
</html>
