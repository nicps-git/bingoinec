<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Debug Bot√£o Atualizar</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .btn-teste {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .btn-teste:hover {
            background: #0056b3;
        }
        .btn-teste:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
        .erro {
            color: #dc3545;
            font-weight: bold;
        }
        .sucesso {
            color: #28a745;
            font-weight: bold;
        }
        .aviso {
            color: #ffc107;
            font-weight: bold;
        }
        .info {
            color: #17a2b8;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üîß Debug Bot√£o Atualizar</h1>
        <p>Esta p√°gina testa especificamente a fun√ß√£o do bot√£o "Atualizar" para identificar o problema.</p>
        
        <div class="controles">
            <button class="btn-teste btn-atualizar" onclick="testarAtualizarSorteio()">üîÑ Testar Atualizar</button>
            <button class="btn-teste" onclick="verificarDependencias()">üîç Verificar Depend√™ncias</button>
            <button class="btn-teste" onclick="simularDados()">üìã Simular Dados</button>
            <button class="btn-teste" onclick="limparLog()">üßπ Limpar Log</button>
        </div>
        
        <div id="log-area" class="log-area">
            <div class="info">[IN√çCIO] Debug iniciado...</div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
    <script src="firebase-config.js"></script>
    <script src="firebase-service.js"></script>

    <script>
        // Vari√°veis globais para simular estado
        let compradorAtual = null;
        let cartelasComprador = [];
        let numerosSorteados = [];
        let firebaseService = null;

        function log(mensagem, tipo = 'info') {
            const logArea = document.getElementById('log-area');
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = tipo;
            div.innerHTML = `[${timestamp}] ${mensagem}`;
            logArea.appendChild(div);
            logArea.scrollTop = logArea.scrollHeight;
            console.log(`[${tipo.toUpperCase()}] ${mensagem}`);
        }

        function limparLog() {
            document.getElementById('log-area').innerHTML = '<div class="info">[LIMPO] Log limpo...</div>';
        }

        function verificarDependencias() {
            log('üîç Verificando depend√™ncias...', 'info');
            
            // Verificar Firebase
            if (typeof firebase !== 'undefined') {
                log('‚úÖ Firebase carregado', 'sucesso');
            } else {
                log('‚ùå Firebase N√ÉO carregado', 'erro');
            }
            
            // Verificar FirebaseService
            setTimeout(() => {
                if (typeof window.firebaseService !== 'undefined' && window.firebaseService) {
                    log('‚úÖ FirebaseService dispon√≠vel', 'sucesso');
                    firebaseService = window.firebaseService;
                } else {
                    log('‚ùå FirebaseService N√ÉO dispon√≠vel', 'erro');
                }
                
                // Verificar fun√ß√µes espec√≠ficas
                if (firebaseService) {
                    if (typeof firebaseService.carregarNumerosSorteados === 'function') {
                        log('‚úÖ Fun√ß√£o carregarNumerosSorteados dispon√≠vel', 'sucesso');
                    } else {
                        log('‚ùå Fun√ß√£o carregarNumerosSorteados N√ÉO dispon√≠vel', 'erro');
                    }
                    
                    if (typeof firebaseService.carregarCartelasPorComprador === 'function') {
                        log('‚úÖ Fun√ß√£o carregarCartelasPorComprador dispon√≠vel', 'sucesso');
                    } else {
                        log('‚ùå Fun√ß√£o carregarCartelasPorComprador N√ÉO dispon√≠vel', 'erro');
                    }
                }
            }, 2000);
        }

        function simularDados() {
            log('üìã Simulando dados de teste...', 'info');
            
            compradorAtual = {
                nome: 'Jo√£o Silva',
                telefone: '85987654321',
                email: 'joao@teste.com'
            };
            
            cartelasComprador = [{
                id: 'TESTE001',
                numeros: [1, 16, 31, 46, 61, 2, 17, 32, 47, 62, 3, 18, 33, 48, 63, 4, 19, 34, 49, 64, 5, 20, 35, 50, 65],
                preco: 5.00
            }];
            
            numerosSorteados = [1, 16, 31];
            
            log('‚úÖ Dados simulados:', 'sucesso');
            log(`   - Comprador: ${compradorAtual.nome}`, 'info');
            log(`   - Cartelas: ${cartelasComprador.length}`, 'info');
            log(`   - N√∫meros sorteados: ${numerosSorteados.length}`, 'info');
        }

        function mostrarNotificacao(mensagem, tipo = 'info') {
            log(`üì¢ Notifica√ß√£o: ${mensagem} (${tipo})`, 'info');
        }

        function atualizarNumerosSorteados() {
            log('üîÑ atualizarNumerosSorteados() chamada', 'info');
        }

        function atualizarCartelas() {
            log('üé´ atualizarCartelas() chamada', 'info');
        }

        function verificarStatusCartelas() {
            log('üîç verificarStatusCartelas() chamada', 'info');
        }

        // Fun√ß√£o de teste que replica a fun√ß√£o original
        async function testarAtualizarSorteio() {
            log('üîÑ Iniciando teste da fun√ß√£o atualizarSorteio...', 'info');
            
            // Simular bot√£o
            const btnAtualizar = document.querySelector('.btn-atualizar');
            const textoOriginal = btnAtualizar.textContent;
            btnAtualizar.textContent = 'üîÑ Atualizando...';
            btnAtualizar.disabled = true;
            
            try {
                log('üîç Verificando firebaseService...', 'info');
                
                if (!firebaseService) {
                    log('‚ùå FirebaseService n√£o est√° dispon√≠vel', 'erro');
                    mostrarNotificacao('‚ùå Erro: Firebase n√£o conectado', 'erro');
                    return;
                }
                
                log('‚úÖ FirebaseService encontrado, testando carregarNumerosSorteados...', 'sucesso');
                
                // Testar carregamento de n√∫meros sorteados
                const numerosSorteadosCarregados = await firebaseService.carregarNumerosSorteados();
                log(`‚úÖ N√∫meros sorteados carregados: ${JSON.stringify(numerosSorteadosCarregados)}`, 'sucesso');
                
                // Atualizar vari√°veis globais
                numerosSorteados = numerosSorteadosCarregados;
                atualizarNumerosSorteados();
                
                // Testar recarregamento de cartelas
                if (compradorAtual && compradorAtual.telefone) {
                    log('üîÑ Testando recarregamento de cartelas...', 'info');
                    
                    const cartelas = await firebaseService.carregarCartelasPorComprador(
                        compradorAtual.telefone, 
                        compradorAtual.email
                    );
                    
                    log(`‚úÖ Cartelas carregadas: ${cartelas.length}`, 'sucesso');
                    
                    if (cartelas && cartelas.length > 0) {
                        cartelasComprador = cartelas;
                        atualizarCartelas();
                        verificarStatusCartelas();
                    }
                } else {
                    log('‚ö†Ô∏è Comprador atual n√£o definido', 'aviso');
                }
                
                log('‚úÖ Teste conclu√≠do com sucesso!', 'sucesso');
                mostrarNotificacao('‚úÖ Dados atualizados com sucesso!', 'sucesso');
                
            } catch (error) {
                log(`‚ùå Erro durante o teste: ${error.message}`, 'erro');
                log(`‚ùå Stack trace: ${error.stack}`, 'erro');
                mostrarNotificacao('‚ùå Erro ao atualizar dados', 'erro');
            } finally {
                // Restaurar bot√£o
                setTimeout(() => {
                    btnAtualizar.textContent = textoOriginal;
                    btnAtualizar.disabled = false;
                    log('üîÑ Bot√£o restaurado', 'info');
                }, 1000);
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            log('üìÑ P√°gina carregada, verificando depend√™ncias em 2 segundos...', 'info');
            setTimeout(verificarDependencias, 2000);
            
            // Simular dados automaticamente
            setTimeout(simularDados, 3000);
        });
    </script>
</body>
</html>
